<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProTools - ì˜¬ì¸ì› ë„êµ¬í•¨</title>
    <!-- Last Build: 2026-01-25 13:40 (API Fix) -->
    <meta name="google-adsense-account" content="ca-pub-5655610048474795">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5655610048474795"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/lunar-javascript@1.6.12/lunar.min.js"></script>
    <meta name="description" content="D-day, ë§Œ ë‚˜ì´, ê¸€ììˆ˜ ê³„ì‚°ê¸°, ë‹¨ìœ„ ë³€í™˜ê¸° ë“± ì¼ìƒì— ê¼­ í•„ìš”í•œ ë„êµ¬ë“¤ì„ í•œ ê³³ì—ì„œ í¸ë¦¬í•˜ê²Œ ì´ìš©í•˜ì„¸ìš”.">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@400;500;600;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700&display=swap');

        :root {
            --primary: #8b5cf6;
            --primary-light: #a78bfa;
            --primary-dark: #6d28d9;
            --secondary: #ec4899;
            --accent: #f59e0b;
            --bg-body: #f8fafc;
            --card-bg: #ffffff;
            --text-main: #1e293b;
            --text-muted: #64748b;
            --border: #e2e8f0;
            --sidebar-bg: #ffffff;
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.12);
            --shadow-md: 0 4px 20px -2px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            --radius-lg: 32px;
            --radius-md: 20px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        [data-theme='dark'] {
            --bg-body: #0f172a;
            --card-bg: #1e293b;
            --text-main: #f1f5f9;
            --text-muted: #94a3b8;
            --border: #334155;
            --sidebar-bg: #1e293b;
            --shadow-md: 0 4px 20px -2px rgba(0, 0, 0, 0.3);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Pretendard', system-ui, -apple-system, sans-serif;
        }

        body {
            background-color: var(--bg-body);
            color: var(--text-main);
            transition: background-color 0.3s, color 0.3s;
            line-height: 1.6;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Navbar */
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 72px;
            background: rgba(var(--card-bg), 0.8);
            backdrop-filter: blur(16px);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 2rem;
            z-index: 1000;
        }

        .nav-left,
        .nav-right {
            flex: 1;
            display: flex;
            align-items: center;
        }

        .nav-right {
            justify-content: flex-end;
        }

        .nav-center {
            display: flex;
            justify-content: center;
            align-items: center;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
        }

        .nav-center::-webkit-scrollbar {
            display: none;
        }

        .logo {
            font-family: 'Outfit', sans-serif;
            font-size: 1.6rem;
            font-weight: 700;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
        }

        @media (max-width: 600px) {
            .logo span {
                display: none;
            }

            .navbar {
                padding: 0 1rem;
            }
        }

        .navbar-menu {
            display: flex;
            gap: 1.5rem;
            list-style: none;
            margin: 0;
            padding: 0;
            white-space: nowrap;
        }

        .navbar-menu a {
            text-decoration: none;
            color: var(--text-main);
            font-weight: 600;
            font-size: 0.9rem;
            transition: var(--transition);
        }

        .navbar-menu a:hover {
            color: var(--primary);
        }

        .theme-toggle {
            cursor: pointer;
            width: 44px;
            height: 44px;
            flex: none;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            background: var(--bg-body);
            border: 1px solid var(--border);
            color: var(--text-main);
            transition: var(--transition);
        }

        .theme-toggle:hover {
            border-color: var(--primary);
        }

        /* Layout */
        .app-container {
            display: flex;
            max-width: 1440px;
            margin: 72px auto 0;
            min-height: calc(100vh - 72px);
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background: var(--sidebar-bg);
            border-right: 1px solid var(--border);
            padding: 2rem 1rem;
            position: sticky;
            top: 72px;
            height: calc(100vh - 72px);
            overflow-y: auto;
            transition: var(--transition);
        }

        @media (max-width: 768px) {
            .app-container {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                height: auto;
                position: static;
                display: flex;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                padding: 0.75rem 1rem;
                gap: 10px;
                border-right: none;
                border-bottom: 1px solid var(--border);
            }

            .sidebar h2 {
                display: none;
            }

            .menu-list {
                display: flex;
                gap: 8px;
            }
        }

        .sidebar h2 {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--text-muted);
            margin: 1.5rem 0 0.75rem 1rem;
        }

        .sidebar h2:first-child {
            margin-top: 0;
        }

        .menu-link {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 0.8rem 1rem;
            text-decoration: none;
            color: var(--text-main);
            border-radius: 14px;
            transition: var(--transition);
            font-weight: 500;
            font-size: 0.95rem;
            white-space: nowrap;
        }

        .menu-link:hover {
            background-color: var(--bg-body);
            color: var(--primary);
            transform: translateX(4px);
        }

        .menu-link.active {
            background-color: rgba(139, 92, 246, 0.1);
            color: var(--primary);
            font-weight: 600;
        }

        .menu-icon {
            width: 20px;
            height: 20px;
            stroke-width: 2px;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            padding: 3rem 4rem;
            max-width: 1000px;
        }

        @media (max-width: 1024px) {
            .main-content {
                padding: 3rem 2rem;
            }
        }

        @media (max-width: 480px) {
            .main-content {
                padding: 2rem 1rem;
            }
        }

        .header-section {
            margin-bottom: 3rem;
        }

        .header-section h1 {
            font-family: 'Outfit', sans-serif;
            font-size: clamp(2rem, 5vw, 2.75rem);
            margin-bottom: 0.75rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 800;
        }

        .header-section p {
            color: var(--text-muted);
            font-size: 1.1rem;
            max-width: 600px;
        }

        /* Calculator Card */
        .calculator-view {
            display: none;
            animation: slideUp 0.5s ease-out;
        }

        .calculator-view.active {
            display: block;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .calc-card {
            background: var(--card-bg);
            border-radius: var(--radius-lg);
            padding: 2.5rem;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border);
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 3rem;
            overflow: hidden;
        }

        @media (max-width: 960px) {
            .calc-card {
                grid-template-columns: 1fr;
                gap: 2rem;
                padding: 1.5rem;
            }
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text-main);
            font-size: 0.95rem;
        }

        .input-wrapper {
            position: relative;
            display: flex;
            align-items: center;
        }

        .input-wrapper input,
        .input-wrapper select,
        .input-wrapper textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border);
            border-radius: 12px;
            font-size: 1rem;
            transition: var(--transition);
            background: var(--bg-body);
            color: var(--text-main);
        }

        .input-wrapper input:focus,
        .input-wrapper select:focus,
        .input-wrapper textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(139, 92, 246, 0.15);
        }

        .btn-calc {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 12px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            font-size: 1.05rem;
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition);
            margin-top: 0.5rem;
        }

        .btn-calc:hover {
            transform: translateY(-2px);
            filter: brightness(1.1);
        }

        .result-panel {
            background: var(--bg-body);
            border-radius: var(--radius-md);
            padding: 2rem;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            border: 1px solid var(--border);
        }

        .result-value {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .result-label {
            color: var(--text-muted);
            font-weight: 600;
            font-size: 0.95rem;
        }

        .unit-grid {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 1rem;
            align-items: center;
        }

        @media (max-width: 600px) {
            .unit-grid {
                grid-template-columns: 1fr;
            }

            .swap-icon {
                transform: rotate(90deg);
                margin: 0.5rem 0;
            }
        }

        textarea {
            min-height: 200px;
            resize: none;
            font-family: inherit;
        }

        .word-stats {
            display: flex;
            gap: 1.5rem;
            margin-top: 1rem;
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        .word-stats b {
            color: var(--primary);
            font-size: 1.1rem;
        }
    </style>
</head>

<body data-theme="light">
    <nav class="navbar">
        <div class="nav-left">
            <a href="index.html" class="logo">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <path
                        d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z" />
                </svg>
                <span>ProTools</span>
            </a>
        </div>
        <div class="nav-center">
            <ul class="navbar-menu">
                <li><a href="index.html">Intro</a></li>
                <li><a href="calc.html">ê³„ì‚°ê¸°</a></li>
                <li><a href="lotto.html">Lotto</a></li>
                <li><a href="money.html">ì£¼ì‹-ì½”ì¸ë¬¼íƒ€ê¸°</a></li>
                <li><a href="changemoney.html">ì‹¤ì‹œê°„ í™˜ì „ê¸°</a></li>
                <li><a href="health.html">ê±´ê°• ê³„ì‚°ê¸°</a></li>
                <li><a href="life.html">ìƒí™œ ê³„ì‚°ê¸°</a></li>
                <li><a href="finance.html">ê¸ˆìœµê³„ì‚°ê¸°</a></li>
                <li><a href="tools.html" style="color:var(--primary)">ë„êµ¬í•¨</a></li>
            </ul>
        </div>
        <div class="nav-right">
            <button class="theme-toggle" onclick="toggleTheme()" id="theme-btn">
                <svg id="sun-icon" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                    stroke-width="2">
                    <circle cx="12" cy="12" r="5" />
                    <path
                        d="M12 1v2m0 18v2M4.22 4.22l1.42 1.42m12.72 12.72l1.42 1.42M1 12h2m18 0h2M4.22 19.78l1.42-1.42M17.66 6.34l1.42-1.42" />
                </svg>
                <svg id="moon-icon" style="display:none" width="22" height="22" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" />
                </svg>
            </button>
        </div>
    </nav>

    <div class="app-container">
        <aside class="sidebar">
            <h2>ì‹œê°„Â·ë‚ ì§œ</h2>
            <div class="menu-list">
                <a href="#dday" class="menu-link active" onclick="showCalc('dday', event)">
                    <svg class="menu-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round"
                        stroke-linejoin="round">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                        <line x1="16" y1="2" x2="16" y2="6"></line>
                        <line x1="8" y1="2" x2="8" y2="6"></line>
                        <line x1="3" y1="10" x2="21" y2="10"></line>
                    </svg>
                    ë‚ ì§œ ê³„ì‚°ê¸° (D-day)
                </a>
                <a href="#age" class="menu-link" onclick="showCalc('age', event)">
                    <svg class="menu-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10"></circle>
                        <polyline points="12 6 12 12 16 14"></polyline>
                    </svg>
                    ë‚˜ì´ ê³„ì‚°ê¸° (ë§Œ ë‚˜ì´)
                </a>
                <a href="#lunar" class="menu-link" onclick="showCalc('lunar', event)">
                    <svg class="menu-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    ìŒì–‘ë ¥ ë³€í™˜ê¸°
                </a>
            </div>
            <h2>ë°ì´í„°Â·ë‹¨ìœ„</h2>
            <div class="menu-list">
                <a href="#wordcount" class="menu-link" onclick="showCalc('wordcount', event)">
                    <svg class="menu-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14 2 14 8 20 8"></polyline>
                        <line x1="16" y1="13" x2="8" y2="13"></line>
                        <line x1="16" y1="17" x2="8" y2="17"></line>
                        <polyline points="10 9 9 9 8 9"></polyline>
                    </svg>
                    ê¸€ììˆ˜ ê³„ì‚°ê¸°
                </a>
                <a href="#unit" class="menu-link" onclick="showCalc('unit', event)">
                    <svg class="menu-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path
                            d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z">
                        </path>
                        <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
                        <line x1="12" y1="22.08" x2="12" y2="12"></line>
                    </svg>
                    ë‹¨ìœ„ ë³€í™˜ê¸°
                </a>
            </div>
            <h2>ì§ì¥Â·ìƒí™œ</h2>
            <div class="menu-list">
                <a href="#vacation" class="menu-link" onclick="showCalc('vacation', event)">
                    <svg class="menu-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round"
                        stroke-linejoin="round">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                        <line x1="16" y1="2" x2="16" y2="6"></line>
                        <line x1="8" y1="2" x2="8" y2="6"></line>
                        <line x1="3" y1="10" x2="21" y2="10"></line>
                        <path d="M8 14h.01"></path>
                        <path d="M12 14h.01"></path>
                        <path d="M16 14h.01"></path>
                        <path d="M8 18h.01"></path>
                        <path d="M12 18h.01"></path>
                        <path d="M16 18h.01"></path>
                    </svg>
                    ì—°ì°¨ ê³„ì‚°ê¸°
                </a>
                <a href="#worktime" class="menu-link" onclick="showCalc('worktime', event)">
                    <svg class="menu-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round"
                        stroke-linejoin="round" stroke-width="2">
                        <rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect>
                        <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path>
                    </svg>
                    ê·¼ë¬´ ì‹œê°„ ê³„ì‚°ê¸°
                </a>
                <a href="#caffeine" class="menu-link" onclick="showCalc('caffeine', event)">
                    <svg class="menu-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round"
                        stroke-linejoin="round" stroke-width="2">
                        <path d="M18 8h1a4 4 0 0 1 0 8h-1"></path>
                        <path d="M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z"></path>
                        <line x1="6" y1="1" x2="6" y2="4"></line>
                        <line x1="10" y1="1" x2="10" y2="4"></line>
                        <line x1="14" y1="1" x2="14" y2="4"></line>
                    </svg>
                    ì¹´í˜ì¸ ê³„ì‚°ê¸°
                </a>
            </div>
        </aside>

        <main class="main-content">
            <!-- D-day Calculation -->
            <div id="dday" class="calculator-view active">
                <div class="header-section">
                    <h1>ë‚ ì§œ ê³„ì‚°ê¸° (D-day)</h1>
                    <p>ê¸°ë…ì¼ì´ë‚˜ ì¤‘ìš”í•œ ë‚ ì§œê¹Œì§€ ë‚¨ì€ ê¸°ê°„ì„ ê³„ì‚°í•©ë‹ˆë‹¤.</p>
                </div>
                <div class="calc-card">
                    <div class="calc-inputs">
                        <div class="form-group">
                            <label>ê¸°ì¤€ ë‚ ì§œ</label>
                            <div class="input-wrapper"><input type="date" id="dday-start"></div>
                            <button class="btn-calc"
                                style="margin-top: 0.5rem; background: var(--bg-body); color: var(--text-main); border: 1px solid var(--border);"
                                onclick="setToday('dday-start')">ì˜¤ëŠ˜ë¡œ ì„¤ì •</button>
                        </div>
                        <div class="form-group">
                            <label>ëª©í‘œ ë‚ ì§œ / ê¸°ë…ì¼</label>
                            <div class="input-wrapper"><input type="date" id="dday-target"></div>
                        </div>
                        <button class="btn-calc" onclick="calcDday()">D-day ê³„ì‚°í•˜ê¸°</button>
                    </div>
                    <div class="result-panel">
                        <div class="result-value" id="dday-val">D-0</div>
                        <div class="result-label" id="dday-label">ê²°ê³¼</div>
                    </div>
                </div>
            </div>

            <!-- Age Calculation -->
            <div id="age" class="calculator-view">
                <div class="header-section">
                    <h1>ë‚˜ì´ ê³„ì‚°ê¸°</h1>
                    <p>ìƒë…„ì›”ì¼ì„ ê¸°ì¤€ìœ¼ë¡œ í˜„ì¬ ë§Œ ë‚˜ì´ì™€ ë ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.</p>
                </div>
                <div class="calc-card">
                    <div class="calc-inputs">
                        <div class="form-group">
                            <label>ìƒë…„ì›”ì¼</label>
                            <div class="input-wrapper"><input type="date" id="age-birth"></div>
                        </div>
                        <div class="form-group">
                            <label>ê¸°ì¤€ì¼ (ê¸°ë³¸: ì˜¤ëŠ˜)</label>
                            <div class="input-wrapper"><input type="date" id="age-base"></div>
                        </div>
                        <button class="btn-calc" onclick="calcAge()">ë‚˜ì´ ë¶„ì„í•˜ê¸°</button>
                    </div>
                    <div class="result-panel">
                        <div class="result-value" id="age-val">ë§Œ 0ì„¸</div>
                        <div class="result-label" id="age-label">ë¶„ì„ ê²°ê³¼</div>
                    </div>
                </div>
            </div>

            <!-- Lunar/Solar Converter (Basic Placeholder with UI) -->
            <div id="lunar" class="calculator-view">
                <div class="header-section">
                    <h1>ìŒì–‘ë ¥ ë³€í™˜ê¸°</h1>
                    <p>ì–‘ë ¥ ë‚ ì§œë¥¼ ìŒë ¥ìœ¼ë¡œ, ë˜ëŠ” ìŒë ¥ ë‚ ì§œë¥¼ ì–‘ë ¥ìœ¼ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.</p>
                </div>
                <div class="calc-card">
                    <div class="calc-inputs">
                        <div class="form-group">
                            <label>ë³€í™˜ ë°©í–¥</label>
                            <div class="input-wrapper">
                                <select id="lunar-mode">
                                    <option value="s2l">ì–‘ë ¥ â†’ ìŒë ¥</option>
                                    <option value="l2s">ìŒë ¥ â†’ ì–‘ë ¥</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>ë‚ ì§œ ì…ë ¥</label>
                            <div class="input-wrapper"><input type="date" id="lunar-date"></div>
                        </div>
                        <button class="btn-calc" onclick="convertLunar()">ë³€í™˜í•˜ê¸°</button>
                    </div>
                    <div class="result-panel">
                        <div class="result-value" id="lunar-val" style="font-size: 1.5rem;">ë‚ ì§œë¥¼ ì…ë ¥í•˜ì„¸ìš”</div>
                        <div class="result-label">ë³€í™˜ëœ ë‚ ì§œ</div>
                        <p style="margin-top:1rem; font-size:0.8rem; color:var(--text-muted)">* ê³µê³µ ë°ì´í„° ê¸°ë°˜ ì¶”ì • ë°©ì‹ì…ë‹ˆë‹¤.</p>
                    </div>
                </div>
            </div>

            <!-- Word Counter -->
            <div id="wordcount" class="calculator-view">
                <div class="header-section">
                    <h1>ê¸€ììˆ˜ ê³„ì‚°ê¸°</h1>
                    <p>ìê¸°ì†Œê°œì„œë‚˜ ë¬¸ì„œ ì‘ì„± ì‹œ ê¸€ììˆ˜ì™€ ê³µë°±ì„ ì²´í¬í•©ë‹ˆë‹¤.</p>
                </div>
                <div class="calc-card" style="grid-template-columns: 1fr;">
                    <div class="calc-inputs">
                        <div class="form-group">
                            <div class="input-wrapper">
                                <textarea id="word-input" placeholder="ì—¬ê¸°ì— í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ê±°ë‚˜ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”..."></textarea>
                            </div>
                        </div>
                        <div class="word-stats">
                            <span>ê³µë°± í¬í•¨: <b id="count-with">0</b> ì</span>
                            <span>ê³µë°± ì œì™¸: <b id="count-without">0</b> ì</span>
                            <span>ì¤„ ìˆ˜: <b id="count-lines">0</b> ì¤„</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Unit Converter -->
            <div id="unit" class="calculator-view">
                <div class="header-section">
                    <h1>ë‹¨ìœ„ ë³€í™˜ê¸°</h1>
                    <p>ê¸¸ì´, ë¬´ê²Œ, ë¶€í”¼ ë“± ë‹¤ì–‘í•œ ë‹¨ìœ„ë¥¼ ê°„í¸í•˜ê²Œ ë³€í™˜í•©ë‹ˆë‹¤.</p>
                </div>
                <div class="calc-card">
                    <div class="calc-inputs">
                        <div class="form-group">
                            <label>ë³€í™˜ ì¢…ë¥˜</label>
                            <div class="input-wrapper">
                                <select id="unit-type" onchange="updateUnits()">
                                    <option value="length">ê¸¸ì´ (Length)</option>
                                    <option value="weight">ë¬´ê²Œ (Weight)</option>
                                    <option value="volume">ë¶€í”¼ (Volume)</option>
                                    <option value="temp">ì˜¨ë„ (Temperature)</option>
                                    <option value="speed">ì†ë„ (Speed)</option>
                                    <option value="time">ì‹œê°„ (Time)</option>
                                    <option value="area">ë„“ì´ (Area)</option>
                                </select>
                            </div>
                        </div>
                        <div class="unit-grid">
                            <div class="form-group" style="margin:0">
                                <div class="input-wrapper"><input type="number" id="unit-from-val" value="1"
                                        oninput="convertUnit()"></div>
                                <select id="unit-from-type" style="margin-top:8px" onchange="convertUnit()"></select>
                            </div>
                            <div style="font-size:1.5rem; color:var(--primary)" class="swap-icon">â†’</div>
                            <div class="form-group" style="margin:0">
                                <div class="input-wrapper"><input type="number" id="unit-to-val" readonly></div>
                                <select id="unit-to-type" style="margin-top:8px" onchange="convertUnit()"></select>
                            </div>
                        </div>
                    </div>
                    <div class="result-panel">
                        <div class="result-value" id="unit-result" style="font-size: 1.8rem;">1 = 1</div>
                        <div class="result-label">ë‹¨ìœ„ ë³€í™˜ ê²°ê³¼</div>
                    </div>
                </div>
            </div>

            <!-- Vacation Calculator (Redesigned) -->
            <div id="vacation" class="calculator-view">
                <style>
                    /* Dashboard Theme - Light Mode Default */
                    .vac-dashboard {
                        background: #ffffff;
                        border-radius: 20px;
                        padding: 2px;
                        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
                        border: 1px solid #e2e8f0;
                        color: #1e293b;
                        font-family: 'Pretendard', sans-serif;
                    }

                    /* Top Tabs */
                    .vac-tabs {
                        display: flex;
                        background: #f8fafc;
                        border-radius: 18px 18px 0 0;
                        padding: 0 10px;
                        overflow: hidden;
                        border-bottom: 1px solid #e2e8f0;
                    }

                    .vac-tab {
                        flex: 1;
                        padding: 16px;
                        background: transparent;
                        border: none;
                        color: #64748b;
                        font-weight: 600;
                        cursor: pointer;
                        transition: all 0.2s;
                        border-bottom: 3px solid transparent;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        gap: 8px;
                    }

                    .vac-tab:hover {
                        color: #334155;
                        background: rgba(0, 0, 0, 0.02);
                    }

                    .vac-tab.active {
                        color: var(--primary);
                        border-bottom-color: var(--primary);
                        background: rgba(139, 92, 246, 0.05);
                    }

                    /* Input Section */
                    .vac-inputs-card {
                        background: #f1f5f9;
                        margin: 20px;
                        padding: 24px;
                        border-radius: 16px;
                        border: 1px solid #cbd5e1;
                    }

                    .vac-input-row {
                        display: grid;
                        grid-template-columns: 1fr 1fr;
                        gap: 20px;
                        margin-bottom: 15px;
                    }

                    @media (max-width: 768px) {
                        .vac-input-row {
                            grid-template-columns: 1fr;
                        }
                    }

                    .vac-input-group label {
                        display: block;
                        margin-bottom: 8px;
                        font-size: 0.85rem;
                        color: #475569;
                        font-weight: 500;
                    }

                    .vac-input-control {
                        width: 100%;
                        background: #ffffff;
                        border: 1px solid #cbd5e1;
                        color: #1e293b;
                        padding: 12px;
                        border-radius: 8px;
                        font-size: 0.95rem;
                        outline: none;
                        transition: border-color 0.2s;
                    }

                    .vac-input-control:focus {
                        border-color: var(--primary);
                    }

                    /* Buttons */
                    .vac-actions {
                        display: flex;
                        gap: 10px;
                        margin-top: 20px;
                    }

                    .vac-btn {
                        padding: 14px 20px;
                        border-radius: 8px;
                        font-weight: 700;
                        border: none;
                        cursor: pointer;
                        flex: 1;
                        transition: transform 0.1s;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        gap: 6px;
                    }

                    .vac-btn:active {
                        transform: scale(0.98);
                    }

                    .vac-btn-primary {
                        background: linear-gradient(135deg, #3b82f6, #2563eb);
                        color: white;
                        flex: 2;
                    }

                    .vac-btn-success {
                        background: #10b981;
                        color: white;
                    }

                    .vac-btn-secondary {
                        background: #e2e8f0;
                        color: #475569;
                    }

                    .vac-btn-secondary:hover {
                        background: #cbd5e1;
                    }

                    /* Content Areas */
                    .vac-content-area {
                        display: none;
                        padding: 0 20px 20px 20px;
                        animation: fadeIn 0.3s;
                    }

                    .vac-content-area.active {
                        display: block;
                    }

                    /* Plan Dashboard */
                    .vac-plan-dash {
                        display: grid;
                        grid-template-columns: repeat(4, 1fr);
                        gap: 15px;
                        margin-bottom: 25px;
                    }

                    @media (max-width: 600px) {
                        .vac-plan-dash {
                            grid-template-columns: 1fr 1fr;
                        }
                    }

                    .dash-item {
                        background: #ffffff;
                        padding: 15px;
                        border-radius: 12px;
                        border-left: 4px solid #94a3b8;
                        border: 1px solid #e2e8f0;
                        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.03);
                    }

                    .dash-item .l {
                        font-size: 0.8rem;
                        color: #64748b;
                        display: block;
                        margin-bottom: 5px;
                    }

                    .dash-item .v {
                        font-size: 1.5rem;
                        font-weight: 800;
                        color: #0f172a;
                    }

                    .dash-item.blue .v {
                        color: #60a5fa;
                    }

                    .dash-item.red .v {
                        color: #f87171;
                    }

                    .dash-item.purple .v {
                        color: #c084fc;
                    }

                    .dash-item.green .v {
                        color: #34d399;
                    }

                    /* Plan Grid */
                    .vac-plan-grid {
                        display: grid;
                        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
                        gap: 15px;
                    }

                    .plan-card {
                        background: #ffffff;
                        border: 1px solid #e2e8f0;
                        border-radius: 12px;
                        padding: 15px;
                    }

                    .plan-card-head {
                        display: flex;
                        align-items: center;
                        justify-content: space-between;
                        margin-bottom: 10px;
                        border-bottom: 1px solid #cbd5e1;
                        padding-bottom: 8px;
                    }

                    .plan-card-head span {
                        font-weight: 700;
                        color: #1e293b;
                    }

                    .plan-input-mini {
                        background: #ffffff;
                        border: 1px solid #cbd5e1;
                        padding: 4px 8px;
                        border-radius: 4px;
                        color: #1e293b;
                        width: 60px;
                        text-align: right;
                    }

                    /* Risk Dashboard */
                    .vac-risk-container {
                        display: grid;
                        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                        gap: 15px;
                        margin-bottom: 20px;
                    }

                    .vac-risk-card {
                        background: #ffffff;
                        border: 1px solid #e2e8f0;
                        padding: 20px;
                        border-radius: 12px;
                        text-align: center;
                    }

                    .vac-risk-card .l {
                        font-size: 0.85rem;
                        color: #64748b;
                        margin-bottom: 8px;
                    }

                    .vac-risk-card .v {
                        font-size: 1.4rem;
                        font-weight: 700;
                        color: #1e293b;
                    }

                    .risk-badge {
                        padding: 4px 12px;
                        border-radius: 20px;
                        font-size: 0.9rem;
                        display: inline-block;
                    }

                    .risk-badge.danger {
                        background: rgba(248, 113, 113, 0.2);
                        color: #f87171;
                        border: 1px solid #f87171;
                    }

                    .risk-badge.warning {
                        background: rgba(251, 146, 60, 0.2);
                        color: #fb923c;
                        border: 1px solid #fb923c;
                    }

                    .risk-badge.safe {
                        background: rgba(52, 211, 153, 0.2);
                        color: #34d399;
                        border: 1px solid #34d399;
                    }

                    .vac-strategy-box {
                        background: rgba(59, 130, 246, 0.05);
                        border: 1px solid rgba(59, 130, 246, 0.2);
                        padding: 20px;
                        border-radius: 12px;
                        margin-bottom: 25px;
                    }

                    .vac-sim-grid {
                        display: flex;
                        gap: 5px;
                        margin-top: 10px;
                        overflow-x: auto;
                        padding-bottom: 5px;
                    }

                    .vac-sim-bar {
                        flex: 1;
                        min-width: 50px;
                        text-align: center;
                        background: #1e293b;
                        padding: 10px 5px;
                        border-radius: 8px;
                        border: 1px solid #334155;
                    }

                    /* History Grid */
                    .history-grid {
                        display: flex;
                        flex-wrap: wrap;
                        gap: 12px;
                        margin-top: 15px;
                    }

                    .history-item {
                        flex: 0 0 auto;
                        min-width: 100px;
                        background: #ffffff;
                        border: 1px solid #e2e8f0;
                        border-radius: 12px;
                        padding: 12px;
                        text-align: center;
                        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
                    }

                    .history-month {
                        font-size: 0.85rem;
                        color: #64748b;
                        margin-bottom: 4px;
                    }

                    .history-val {
                        font-size: 1.2rem;
                        font-weight: 800;
                        color: var(--primary);
                    }

                    .history-acc {
                        font-size: 0.75rem;
                        color: #94a3b8;
                        margin-top: 4px;
                    }
                </style>

                <div class="header-section" style="margin-bottom:2rem; text-align: left;">
                    <h1 style="color:#1e293b; margin: 0 0 0.5rem 0; font-size: 2.8rem; font-weight: 800;">ì—°ì°¨ ê³„ì‚°ê¸°</h1>
                    <p style="color:#64748b; font-size: 1.1rem; margin: 0;">ë³µì¡í•œ ì—°ì°¨ ê³„ì‚°ë¶€í„° ì†Œë©¸ ê´€ë¦¬ê¹Œì§€ í•œë²ˆì— í•´ê²°í•˜ì„¸ìš”.</p>
                </div>

                <div class="vac-dashboard">
                    <!-- Tab Navigation -->
                    <div class="vac-tabs">
                        <button class="vac-tab active" onclick="switchVacTab('basic')">ğŸ“‹ ê¸°ë³¸ ê³„ì‚°</button>
                        <button class="vac-tab" onclick="switchVacTab('plan')">ğŸ“… ì—°ì°¨ ê³„íš</button>
                        <button class="vac-tab" onclick="switchVacTab('expire')">â³ ì†Œë©¸ ê´€ë¦¬</button>
                    </div>

                    <!-- Common Inputs (Always Visible) -->
                    <div class="vac-inputs-card">
                        <div class="vac-input-row">
                            <div class="vac-input-group">
                                <label>ğŸ“… ì…ì‚¬ì¼</label>
                                <input type="date" id="vac-start" class="vac-input-control">
                            </div>
                            <div class="vac-input-group">
                                <label>â±ï¸ ê³„ì‚° ê¸°ì¤€ì¼</label>
                                <div style="display:flex; gap:8px;">
                                    <input type="date" id="vac-end" class="vac-input-control">
                                    <button class="vac-btn vac-btn-secondary" style="flex:0 0 60px;"
                                        onclick="setToday('vac-end')">ì˜¤ëŠ˜</button>
                                </div>
                            </div>
                        </div>
                        <div class="vac-input-row">
                            <div class="vac-input-group">
                                <label>ğŸ’ ê¸°ì‚¬ìš© ì—°ì°¨</label>
                                <input type="number" id="vac-used" placeholder="0" min="0" step="0.5"
                                    class="vac-input-control">
                            </div>
                            <div class="vac-input-group">
                                <label>ğŸ“ˆ ì¶œê·¼ìœ¨ ê³„ì‚° ë°©ì‹</label>
                                <select id="vac-method" class="vac-input-control" onchange="toggleVacMethod()">
                                    <option value="auto">ìë™ ê³„ì‚° (100% ë§Œê·¼ ê°€ì •)</option>
                                    <option value="manual">ì§ì ‘ ì…ë ¥ (80% ë¯¸ë§Œ ì²´í¬)</option>
                                </select>
                            </div>
                        </div>

                        <!-- Manual Input Box -->
                        <div id="vac-manual-box"
                            style="display:none; margin-bottom:15px; border-top:1px dashed #475569; padding-top:15px;">
                            <div class="vac-input-row">
                                <div class="vac-input-group">
                                    <label>ì´ ì†Œì • ê·¼ë¡œì¼ìˆ˜</label>
                                    <input type="number" id="att-total" class="vac-input-control" placeholder="ì˜ˆ: 250">
                                </div>
                                <div class="vac-input-group">
                                    <label>ì‹¤ì œ ì¶œê·¼ì¼ìˆ˜</label>
                                    <input type="number" id="att-actual" class="vac-input-control" placeholder="ì˜ˆ: 240">
                                </div>
                            </div>
                        </div>

                        <div class="vac-actions">
                            <button class="vac-btn vac-btn-primary" onclick="calcVacationBasic()">ğŸ§® ì—°ì°¨ê°œìˆ˜ ê³„ì‚°í•˜ê¸°</button>
                            <button class="vac-btn vac-btn-success" onclick="saveVacationData()">ğŸ’¾ ì €ì¥</button>
                            <button class="vac-btn vac-btn-secondary" id="btn-history"
                                onclick="toggleHistoryModal(true)">ğŸ”„ ê¸°ë¡</button>
                        </div>
                    </div>

                    <!-- Content: Basic -->
                    <div id="vac-content-basic" class="vac-content-area active">
                        <div id="basic-placeholder" style="text-align:center; padding:50px; color:#64748b;">
                            <div style="font-size:3rem; margin-bottom:10px;">ğŸ‘‹</div>
                            <p>ì…ì‚¬ì¼ì„ ì…ë ¥í•˜ê³  'ê³„ì‚°í•˜ê¸°'ë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš”.</p>
                        </div>
                        <div id="basic-result-area" style="display:none;">
                            <h3 style="margin-bottom:15px; color:#e2e8f0;">ğŸ“Š ê³„ì‚° ê²°ê³¼</h3>
                            <div class="vac-plan-dash">
                                <div class="dash-item blue">
                                    <span class="l">ê·¼ì† ê¸°ê°„</span>
                                    <span class="v" id="res-period" style="font-size:1.1rem;">-</span>
                                </div>
                                <div class="dash-item red">
                                    <span class="l">ë²•ì • ë°œìƒ ì—°ì°¨</span>
                                    <span class="v" id="res-total">0ê°œ</span>
                                </div>
                                <div class="dash-item green">
                                    <span class="l">í˜„ì¬ ì”ì—¬ ì—°ì°¨</span>
                                    <span class="v" id="res-remain">0ê°œ</span>
                                </div>
                                <div class="dash-item purple">
                                    <span class="l">ì‚¬ìš©ë¥ </span>
                                    <span class="v" id="res-usage-rate">0%</span>
                                </div>
                            </div>
                            <h4 style="margin:20px 0 10px; color:#cbd5e1;">ğŸ—“ï¸ ìƒì„¸ ë°œìƒ ë‚´ì—­</h4>
                            <div id="history-grid" class="history-grid"></div>
                        </div>
                    </div>

                    <!-- Content: Plan -->
                    <div id="vac-content-plan" class="vac-content-area">
                        <h3 style="margin-bottom:15px;">ğŸ’³ ì—°ì°¨ ì‚¬ìš© ê³„íš í˜„í™©</h3>
                        <div class="vac-plan-dash">
                            <div class="dash-item blue">
                                <span class="l">ì´ ì—°ì°¨</span>
                                <span class="v" id="plan-total">0</span>
                            </div>
                            <div class="dash-item red">
                                <span class="l">ì´ë¯¸ ì‚¬ìš©</span>
                                <span class="v" id="plan-used">0</span>
                            </div>
                            <div class="dash-item purple">
                                <span class="l">ê³„íšëœ ì‚¬ìš©</span>
                                <span class="v" id="plan-planned">0</span>
                            </div>
                            <div class="dash-item green">
                                <span class="l">ë‚¨ì€ ì—°ì°¨ (ê³„íš ë°˜ì˜)</span>
                                <span class="v" id="plan-remain">0</span>
                            </div>
                        </div>

                        <div
                            style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                            <h4>ğŸ—“ï¸ ì›”ë³„ ìƒì„¸ ê³„íš</h4>
                            <span style="font-size:0.8rem; color:#94a3b8;">* ê° ì›”ì˜ ì¹´ë“œë¥¼ ìˆ˜ì •í•˜ë©´ ìë™ ì €ì¥ë©ë‹ˆë‹¤</span>
                        </div>
                        <div id="plan-grid" class="vac-plan-grid"></div>
                    </div>

                    <!-- Content: Expire -->
                    <div id="vac-content-expire" class="vac-content-area">
                        <h3 style="margin-bottom:15px;">â±ï¸ ì—°ì°¨ ì†Œë©¸ ìœ„í—˜ë„ ë¶„ì„</h3>
                        <div class="vac-risk-container">
                            <div class="vac-risk-card">
                                <div class="l">í˜„ì¬ ì‹¤ì§ˆ ì”ì—¬</div>
                                <div class="v" style="color:#60a5fa;" id="exp-remain">-</div>
                            </div>
                            <div class="vac-risk-card">
                                <div class="l">ì—°ë§ê¹Œì§€ ë‚¨ì€ ê¸°ê°„</div>
                                <div class="v" style="color:#fb923c;"><span id="exp-months">0</span>ê°œì›”</div>
                            </div>
                            <div class="vac-risk-card">
                                <div class="l">ì›” ê¶Œì¥ ì‚¬ìš©ëŸ‰</div>
                                <div class="v" style="color:#c084fc;"><span id="exp-rec">0</span>ê°œ</div>
                            </div>
                            <div class="vac-risk-card">
                                <div class="l">ìœ„í—˜ë„ ì§„ë‹¨</div>
                                <div id="exp-badge" class="risk-badge safe">ì•ˆì „</div>
                            </div>
                        </div>

                        <div class="vac-strategy-box">
                            <h4 style="color:#60a5fa; margin-bottom:10px;">ğŸ’¡ ì†Œë©¸ ë°©ì§€ ì „ëµ</h4>
                            <ul style="padding-left:20px; color:#64748b; line-height:1.6;">
                                <li>ì—°ì°¨ ì‚¬ìš© ì´‰ì§„ ì œë„ê°€ ì‹œí–‰ë˜ë©´, ë¯¸ì‚¬ìš© ì—°ì°¨ì— ëŒ€í•œ ìˆ˜ë‹¹ì„ ë°›ì§€ ëª»í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
                                <li><strong>ì›” 1íšŒ ì´ìƒ</strong> ì˜ë¬´ì ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” ìŠµê´€ì„ ë“¤ì´ì„¸ìš”.</li>
                                <li>ì”ì—¬ ì—°ì°¨ê°€ ë§ë‹¤ë©´ ì§•ê²€ë‹¤ë¦¬ íœ´ì¼ì´ë‚˜ ëª…ì ˆ ì „í›„ë¥¼ ê³µëµí•˜ì„¸ìš”.</li>
                            </ul>
                        </div>

                        <h4 style="margin-top:30px; margin-bottom:10px;">ğŸ“Š ì›”ë³„ ê¶Œì¥ ì‚¬ìš©ëŸ‰ ì‹œë®¬ë ˆì´ì…˜</h4>
                        <div id="exp-simulation" class="vac-sim-grid"></div>
                    </div>

                    <!-- History Modal (Reused) -->
                    <div id="history-modal"
                        style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); z-index:9999; justify-content:center; align-items:center; backdrop-filter:blur(5px);">
                        <div
                            style="background:#ffffff; width:90%; max-width:500px; max-height:80vh; border-radius:16px; display:flex; flex-direction:column; box-shadow:0 25px 50px -12px rgba(0,0,0,0.15); border:1px solid #cbd5e1;">
                            <div
                                style="padding:20px; border-bottom:1px solid #e2e8f0; display:flex; justify-content:space-between; align-items:center;">
                                <h3 style="margin:0; color:#1e293b;">ğŸ—‚ï¸ ì €ì¥ëœ ê¸°ë¡</h3>
                                <button onclick="toggleHistoryModal(false)"
                                    style="background:none; border:none; font-size:1.5rem; cursor:pointer; color:#94a3b8;">&times;</button>
                            </div>
                            <div id="saved-list" style="flex:1; overflow-y:auto; padding:0;"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Work Time Calculator (Upgraded) -->
            <div id="worktime" class="calculator-view">
                <style>
                    .wt-dashboard {
                        background: var(--card-bg);
                        border-radius: 20px;
                        border: 1px solid var(--border);
                        overflow: hidden;
                    }

                    .wt-tabs {
                        display: flex;
                        background: rgba(0, 0, 0, 0.03);
                        border-bottom: 1px solid var(--border);
                    }

                    .wt-tab {
                        flex: 1;
                        padding: 14px;
                        text-align: center;
                        background: none;
                        border: none;
                        font-weight: 600;
                        color: var(--text-muted);
                        cursor: pointer;
                        border-bottom: 2px solid transparent;
                        transition: all 0.2s;
                    }

                    .wt-tab.active {
                        color: var(--primary);
                        border-bottom-color: var(--primary);
                        background: var(--card-bg);
                    }

                    .wt-content {
                        display: none;
                        padding: 20px;
                    }

                    .wt-content.active {
                        display: block;
                    }

                    .wt-day-card {
                        background: var(--bg-body);
                        border: 1px solid var(--border);
                        border-radius: 12px;
                        padding: 16px;
                        margin-bottom: 12px;
                    }

                    .wt-day-header {
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        margin-bottom: 12px;
                    }

                    .wt-badge {
                        padding: 4px 8px;
                        border-radius: 6px;
                        font-size: 0.75rem;
                        font-weight: 600;
                    }

                    .wt-badge.work {
                        background: rgba(16, 185, 129, 0.1);
                        color: #10b981;
                    }

                    .wt-badge.off {
                        background: rgba(100, 116, 139, 0.1);
                        color: #64748b;
                    }

                    .wt-badge.holiday {
                        background: rgba(239, 68, 68, 0.1);
                        color: #ef4444;
                    }

                    .wt-stats-grid {
                        display: grid;
                        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                        gap: 16px;
                    }

                    .wt-stat-card {
                        background: var(--bg-body);
                        padding: 20px;
                        border-radius: 16px;
                        border: 1px solid var(--border);
                        text-align: center;
                    }

                    .wt-stat-val {
                        font-size: 1.8rem;
                        font-weight: 700;
                        color: var(--text-main);
                        margin: 8px 0;
                    }

                    .wt-stat-label {
                        font-size: 0.9rem;
                        color: var(--text-muted);
                    }
                </style>

                <div class="header-section">
                    <h1>ì£¼ê°„ ê·¼ë¬´ ì‹œê°„ ê³„ì‚°ê¸°</h1>
                    <p>ì£¼ê°„ ê·¼ë¬´ ìŠ¤ì¼€ì¤„ ê´€ë¦¬ ë° ì •ë°€ ê¸‰ì—¬ ë¶„ì„</p>
                </div>

                <div class="wt-dashboard">
                    <div class="wt-tabs">
                        <!-- ... tabs ... -->
                        <button class="wt-tab active" onclick="switchWorkTab('weekly')">ğŸ“… ì£¼ê°„ ê³„ì‚°</button>
                        <button class="wt-tab" onclick="switchWorkTab('allowance')">âš¡ ê°€ì‚°ìˆ˜ë‹¹ ìƒì„¸</button>
                        <button class="wt-tab" onclick="switchWorkTab('analysis')">ğŸ“ˆ ê·¼ë¬´ ë¶„ì„</button>
                    </div>

                    <!-- 1. Weekly Input -->
                    <div id="wt-view-weekly" class="wt-content active">
                        <div class="calc-card"
                            style="margin-bottom:20px; border:1px solid var(--border); box-shadow:none;">
                            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:16px;">
                                <div class="form-group" style="margin:0;">
                                    <label>ì‹œê¸‰ (ì›)</label>
                                    <div class="input-wrapper">
                                        <input type="number" id="wt-wage-in" value="10320" step="10">
                                    </div>
                                </div>
                                <div class="form-group" style="margin:0;">
                                    <label>ì£¼ê°„ ê¸°ì¤€ì¼ (ì‹œì‘ì¼)</label>
                                    <div style="display:flex; gap:12px; align-items:stretch;">
                                        <div class="input-wrapper" style="flex:1;">
                                            <input type="date" id="wt-start-date" onchange="renderWeeklyRows()">
                                        </div>
                                        <button id="btn-wt-history-mini" class="btn-mini"
                                            style="background:var(--secondary); color:white; border:none; padding:0 14px; border-radius:12px; font-size:0.9rem; cursor:pointer; display:flex; align-items:center; justify-content:center; white-space:nowrap;"
                                            onclick="toggleWorkHistoryModal(true)">
                                            ğŸ“‚ (0)
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="wt-daily-list">
                            <!-- JS Generated Rows -->
                        </div>

                        <div style="margin-top:20px; display:flex; gap:10px;">
                            <button class="btn-calc" onclick="calcWeeklyAll()">ì£¼ê°„ ê³„ì‚°í•˜ê¸°</button>
                            <button class="btn-calc"
                                style="background:var(--bg-body); color:var(--text-muted); border:1px solid var(--border);"
                                onclick="resetWeekly()">ì´ˆê¸°í™”</button>
                        </div>
                    </div>

                    <!-- 2. Allowance Detail -->
                    <div id="wt-view-allowance" class="wt-content">
                        <div id="wt-allowance-placeholder"
                            style="text-align:center; padding:40px; color:var(--text-muted);">
                            <div style="font-size:3rem; margin-bottom:10px;">ğŸ§®</div>
                            <p>ë¨¼ì € 'ì£¼ê°„ ê³„ì‚°' íƒ­ì—ì„œ ê·¼ë¬´ ì‹œê°„ì„ ì…ë ¥í•˜ê³  ê³„ì‚°í•´ì£¼ì„¸ìš”.</p>
                        </div>
                        <div id="wt-allowance-result" style="display:none;">
                            <div class="calc-card"
                                style="margin-bottom:20px; box-shadow:none; border:1px solid var(--border);">
                                <h3>ğŸ“Š ìˆ˜ë‹¹ ìƒì„¸ ë‚´ì—­</h3>
                                <div id="wt-allowance-list" style="margin-top:16px;"></div>
                            </div>
                            <div
                                style="font-size:0.85rem; color:var(--text-muted); background:var(--bg-body); padding:16px; border-radius:12px;">
                                <strong>ğŸ’¡ ìˆ˜ë‹¹ ê³„ì‚° ê¸°ì¤€ (2025 ê·¼ë¡œê¸°ì¤€ë²•)</strong>
                                <ul style="padding-left:20px; margin-top:8px; line-height:1.6;">
                                    <li>ì—°ì¥ê·¼ë¡œ: 1ì¼ 8ì‹œê°„ ì´ˆê³¼ ë˜ëŠ” ì£¼ 40ì‹œê°„ ì´ˆê³¼ ì‹œ í†µìƒì„ê¸ˆì˜ 50% ê°€ì‚°</li>
                                    <li>ì•¼ê°„ê·¼ë¡œ: 22:00 ~ 06:00 ì‚¬ì´ ê·¼ë¬´ ì‹œ í†µìƒì„ê¸ˆì˜ 50% ê°€ì‚°</li>
                                    <li>íœ´ì¼ê·¼ë¡œ: 8ì‹œê°„ ì´ë‚´ 50%, 8ì‹œê°„ ì´ˆê³¼ 100% ê°€ì‚°</li>
                                    <li>ì—°ì¥/ì•¼ê°„/íœ´ì¼ ê°€ì‚°ì€ ì¤‘ë³µ ì ìš©ë©ë‹ˆë‹¤.</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- 3. Analysis -->
                    <div id="wt-view-analysis" class="wt-content">
                        <div id="wt-analysis-placeholder"
                            style="text-align:center; padding:40px; color:var(--text-muted);">
                            <div style="font-size:3rem; margin-bottom:10px;">ğŸ“ˆ</div>
                            <p>ê³„ì‚° ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                        </div>
                        <div id="wt-analysis-result" style="display:none;">
                            <h3 style="margin-bottom:16px;">ì´ë²ˆ ì£¼ ê·¼ë¬´ í˜„í™©</h3>
                            <div class="wt-stats-grid">
                                <div class="wt-stat-card">
                                    <div class="wt-stat-label">ì´ ê·¼ë¬´ì‹œê°„</div>
                                    <div class="wt-stat-val" id="an-total-time">0h</div>
                                    <div style="font-size:0.8rem; color:var(--text-muted);">íœ´ê²Œì‹œê°„ ì œì™¸</div>
                                </div>
                                <div class="wt-stat-card">
                                    <div class="wt-stat-label">ì—°ì¥ ê·¼ë¬´</div>
                                    <div class="wt-stat-val" id="an-over-time" style="color:var(--secondary);">0h</div>
                                    <div style="font-size:0.8rem; color:var(--text-muted);">ë²•ì • 40h ì´ˆê³¼ë¶„</div>
                                </div>
                                <div class="wt-stat-card">
                                    <div class="wt-stat-label">ì”ì—¬ ê°€ëŠ¥ ì‹œê°„</div>
                                    <div class="wt-stat-val" id="an-remain-time" style="color:#10b981;">12h</div>
                                    <div style="font-size:0.8rem; color:var(--text-muted);">ì£¼ 52h í•œë„</div>
                                </div>
                                <div class="wt-stat-card">
                                    <div class="wt-stat-label">ì˜ˆìƒ ì£¼ê¸‰</div>
                                    <div class="wt-stat-val" id="an-wage" style="color:var(--primary);">0ì›</div>
                                    <div style="font-size:0.8rem; color:var(--text-muted);">ì„¸ì „ ê¸°ì¤€</div>
                                </div>
                            </div>

                            <div class="calc-card"
                                style="margin-top:20px; box-shadow:none; border:1px solid var(--border); background:rgba(239, 68, 68, 0.05); border-color:rgba(239, 68, 68, 0.2); display:none;"
                                id="an-violation-box">
                                <h4 style="color:#ef4444; display:flex; align-items:center; gap:8px;">âš ï¸ ì£¼ 52ì‹œê°„ ì´ˆê³¼ ì£¼ì˜
                                </h4>
                                <p style="font-size:0.9rem; margin-top:4px; color:#ef4444;">ì´ë²ˆ ì£¼ ë²•ì • ê·¼ë¡œì‹œê°„ í•œë„ë¥¼ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤. ê·¼ë¬´
                                    ìŠ¤ì¼€ì¤„ ì¡°ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Caffeine Calculator -->
            <div id="caffeine" class="calculator-view">
                <div class="header-section">
                    <h1>ì¹´í˜ì¸ ê³„ì‚°ê¸°</h1>
                    <p>ê±´ê°•í•œ ìˆ˜ë©´ì„ ìœ„í•œ ìŠ¤ë§ˆíŠ¸í•œ ì¹´í˜ì¸ ì„­ì·¨ ê´€ë¦¬</p>
                </div>

                <style>
                    .cf-section {
                        margin-bottom: 24px;
                        padding: 20px;
                        background: var(--card-bg);
                        border-radius: 12px;
                        border: 1px solid var(--border);
                    }

                    .cf-grid {
                        display: grid;
                        grid-template-columns: 1fr 1fr;
                        gap: 16px;
                    }

                    .cf-input-wrapper {
                        display: flex;
                        flex-direction: column;
                        gap: 8px;
                        margin-bottom: 12px;
                    }

                    .cf-label {
                        font-size: 0.9rem;
                        font-weight: 600;
                        color: var(--text-main);
                    }

                    .cf-select,
                    .cf-input {
                        width: 100%;
                        padding: 10px;
                        border-radius: 8px;
                        border: 1px solid var(--border);
                        background: var(--bg-body);
                        color: var(--text-main);
                    }

                    .cf-result-box {
                        margin-top: 20px;
                        padding: 20px;
                        background: var(--bg-body);
                        border-radius: 12px;
                        border: 1px solid var(--border);
                    }

                    .cf-badge {
                        padding: 4px 8px;
                        border-radius: 6px;
                        font-size: 0.8rem;
                        font-weight: 600;
                        display: inline-block;
                    }

                    .cf-badge-safe {
                        background: rgba(16, 185, 129, 0.1);
                        color: #10b981;
                    }

                    .cf-badge-warn {
                        background: rgba(245, 158, 11, 0.1);
                        color: #f59e0b;
                    }

                    .cf-badge-danger {
                        background: rgba(239, 68, 68, 0.1);
                        color: #ef4444;
                    }
                </style>

                <!-- 1. User Profile -->
                <div class="cf-section">
                    <h3 style="margin-bottom:12px; color:var(--text-main);">ğŸ‘¤ ì‚¬ìš©ì í”„ë¡œí•„</h3>
                    <div class="cf-grid">
                        <div class="cf-input-wrapper">
                            <label class="cf-label">ì²´ì¤‘ (kg)</label>
                            <input type="number" id="cf-weight" class="cf-input" value="60" placeholder="kg">
                        </div>
                        <div class="cf-input-wrapper">
                            <label class="cf-label">ìƒíƒœ (ë°˜ê°ê¸°)</label>
                            <select id="cf-condition" class="cf-select">
                                <option value="adult">ê±´ê°•í•œ ì„±ì¸ (5h)</option>
                                <option value="smoker">í¡ì—°ì (3h)</option>
                                <option value="pregnant">ì„ì‚°ë¶€/í”¼ì„ì•½ (9h)</option>
                                <option value="youth">ì²­ì†Œë…„/ì–´ë¦°ì´</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- 2. Drink Selection -->
                <div class="cf-section">
                    <h3 style="margin-bottom:12px; color:var(--text-main);">â˜• ìŒë£Œ ì„ íƒ</h3>
                    <div class="cf-grid" style="grid-template-columns: 1fr 1.5fr;">
                        <div class="cf-input-wrapper">
                            <label class="cf-label">ì¹´í…Œê³ ë¦¬</label>
                            <select id="cf-category" class="cf-select" onchange="updateCaffeineMenu()">
                                <option value="franchise">í”„ëœì°¨ì´ì¦ˆ ì»¤í”¼</option>
                                <option value="rtd">í¸ì˜ì /ë§ˆíŠ¸ ìŒë£Œ</option>
                                <option value="etc">ì°¨/ê¸°íƒ€/ì•½êµ­</option>
                            </select>
                        </div>
                        <div class="cf-input-wrapper">
                            <label class="cf-label">ë©”ë‰´</label>
                            <select id="cf-menu" class="cf-select" onchange="updateCaffeineSize()">
                                <!-- JS Populated -->
                            </select>
                        </div>
                    </div>
                    <div class="cf-grid">
                        <div class="cf-input-wrapper">
                            <label class="cf-label">ì‚¬ì´ì¦ˆ/ì˜µì…˜</label>
                            <select id="cf-size" class="cf-select">
                                <!-- JS Populated -->
                            </select>
                        </div>
                        <div class="cf-input-wrapper">
                            <label class="cf-label">ì„­ì·¨ ì‹œê°„</label>
                            <input type="time" id="cf-time" class="cf-input" onwheel="event.preventDefault()">
                        </div>
                    </div>
                    <button class="btn-calc" onclick="addCaffeineItem()">ì„­ì·¨ ì¶”ê°€í•˜ê¸°</button>
                </div>

                <!-- 3. Intake List & Result -->
                <div class="cf-section" id="cf-result-area" style="display:none;">
                    <h3 style="margin-bottom:12px; color:var(--text-main);">ğŸ“Š ë¶„ì„ ê²°ê³¼</h3>

                    <div id="cf-intake-list"
                        style="margin-bottom:16px; border-bottom:1px solid var(--border); padding-bottom:16px;">
                        <!-- List -->
                    </div>

                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:16px; margin-bottom:16px;">
                        <div
                            style="text-align:center; padding:16px; background:var(--bg-body); border-radius:12px; border:1px solid var(--border);">
                            <div style="font-size:0.9rem; color:var(--text-muted);">ì´ ì„­ì·¨ëŸ‰</div>
                            <div style="font-size:1.5rem; font-weight:700; color:var(--text-main);"
                                id="cf-total-amount">0mg</div>
                            <div id="cf-limit-badge" style="font-size:0.8rem; margin-top:4px;">ê¶Œê³ ëŸ‰ ëŒ€ë¹„ ì•ˆì „</div>
                        </div>
                        <div
                            style="text-align:center; padding:16px; background:var(--bg-body); border-radius:12px; border:1px solid var(--border);">
                            <div style="font-size:0.9rem; color:var(--text-muted);">ìˆ˜ë©´ ì˜ˆìƒ ì‹œê°„</div>
                            <div style="font-size:1.5rem; font-weight:700; color:var(--primary);" id="cf-sleep-time">
                                00:00</div>
                            <div style="font-size:0.8rem; color:var(--text-muted); margin-top:4px;">ì²´ë‚´ 50mg ë¯¸ë§Œ ë„ë‹¬</div>
                        </div>
                    </div>

                    <div style="background:#1e293b; padding:16px; border-radius:12px; color:#cbd5e1; font-size:0.9rem;">
                        <div id="cf-advice-text" style="line-height:1.6;">
                            ë¶„ì„ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.
                        </div>
                    </div>
                </div>
            </div>
    </div>

    <script>
        // --- Caffeine Calculator Logic ---
        const caffeineDB = {
            franchise: [
                { name: "ìŠ¤íƒ€ë²…ìŠ¤ ì•„ë©”ë¦¬ì¹´ë…¸", sizes: [{ name: "Tall (355ml)", caf: 150 }, { name: "Grande (473ml)", caf: 225 }, { name: "Venti (591ml)", caf: 300 }] },
                { name: "ìŠ¤íƒ€ë²…ìŠ¤ ì½œë“œë¸Œë£¨", sizes: [{ name: "Tall (355ml)", caf: 155 }, { name: "Grande (473ml)", caf: 205 }] },
                { name: "ë©”ê°€ì»¤í”¼ ì•„ë©”ë¦¬ì¹´ë…¸", sizes: [{ name: "HOT (24oz)", caf: 200 }, { name: "ICE (24oz)", caf: 205 }] },
                { name: "ë©”ê°€ì»¤í”¼ íë¸Œë¼ë–¼", sizes: [{ name: "One Size", caf: 300 }] },
                { name: "ì»´í¬ì¦ˆ ì•„ë©”ë¦¬ì¹´ë…¸", sizes: [{ name: "One Size (2ìƒ·)", caf: 156 }] },
                { name: "ë¹½ë‹¤ë°© ì•—!ë©”ë¦¬ì¹´ë…¸", sizes: [{ name: "ICED (625ml)", caf: 237 }] },
                { name: "ë¹½ë‹¤ë°© ì›ì¡°ì»¤í”¼", sizes: [{ name: "ICED (ë¯¹ìŠ¤)", caf: 371 }] },
                { name: "íˆ¬ì¸ ì•„ë©”ë¦¬ì¹´ë…¸", sizes: [{ name: "Max (591ml)", caf: 285 }] },
                { name: "ì´ë””ì•¼ ì•„ë©”ë¦¬ì¹´ë…¸", sizes: [{ name: "Large", caf: 132 }, { name: "Extra", caf: 264 }] }
            ],
            rtd: [
                { name: "ìŠ¤ëˆ„í”¼ ë”ì§„í•œ ì»¤í”¼ìš°ìœ ", sizes: [{ name: "500ml", caf: 237 }] },
                { name: "ëª¬ìŠ¤í„° ì—ë„ˆì§€", sizes: [{ name: "355ml", caf: 100 }] },
                { name: "í•«ì‹ìŠ¤", sizes: [{ name: "250ml", caf: 60 }] },
                { name: "í•«ì‹ìŠ¤ ë”í‚¹", sizes: [{ name: "330ml", caf: 100 }] },
                { name: "ë ˆë“œë¶ˆ", sizes: [{ name: "250ml", caf: 62.5 }] },
                { name: "ë¹™ê·¸ë ˆ ì»¤í”¼ë§›ìš°ìœ ", sizes: [{ name: "240ml", caf: 45 }] },
                { name: "ì¹¸íƒ€íƒ€ í”„ë¦¬ë¯¸ì—„ ë¼ë–¼", sizes: [{ name: "275ml", caf: 116 }] },
                { name: "T.O.P ë§ˆìŠ¤í„° ë¸”ë Œë“œ", sizes: [{ name: "275ml", caf: 108 }] },
                { name: "ì¡°ì§€ì•„ í¬ë˜í”„íŠ¸", sizes: [{ name: "470ml", caf: 190 }] },
                { name: "ë°•ì¹´ìŠ¤ F", sizes: [{ name: "120ml", caf: 30 }] }
            ],
            etc: [
                { name: "í™ì°¨/ì–¼ê·¸ë ˆì´", sizes: [{ name: "1ì” (250ml)", caf: 50 }] },
                { name: "ë…¹ì°¨ (í‹°ë°±)", sizes: [{ name: "1ê°œ", caf: 20 }] },
                { name: "ë§ì°¨ ë¼ë–¼", sizes: [{ name: "Tall", caf: 60 }] },
                { name: "ê³µì°¨ ë¸”ë™ë°€í¬í‹°", sizes: [{ name: "Large", caf: 60 }] },
                { name: "ë‹¤í¬ ì´ˆì½œë¦¿ (72%)", sizes: [{ name: "100g", caf: 80 }] },
                { name: "ë°€í¬ ì´ˆì½œë¦¿", sizes: [{ name: "100g", caf: 25 }] },
                { name: "ê²Œë³´ë¦°/íœì˜ (ì•½)", sizes: [{ name: "1ì •", caf: 50 }] },
                { name: "íŒí”¼ë¦°/íŒì½œ (ê°ê¸°ì•½)", sizes: [{ name: "1ë³‘", caf: 30 }] },
                { name: "ì½œë¼/ì‚¬ì´ë‹¤", sizes: [{ name: "250ml", caf: 23 }] }
            ]
        };

        let currentIntake = [];

        function initCaffeine() {
            updateCaffeineMenu();
            // Set default time to now
            const now = new Date();
            const hh = String(now.getHours()).padStart(2, '0');
            const mm = String(now.getMinutes()).padStart(2, '0');
            document.getElementById('cf-time').value = `${hh}:${mm}`;
        }

        function updateCaffeineMenu() {
            const cat = document.getElementById('cf-category').value;
            const menuSel = document.getElementById('cf-menu');
            menuSel.innerHTML = '';

            caffeineDB[cat].forEach((item, idx) => {
                menuSel.add(new Option(item.name, idx));
            });
            updateCaffeineSize();
        }

        function updateCaffeineSize() {
            const cat = document.getElementById('cf-category').value;
            const menuIdx = document.getElementById('cf-menu').value;
            const sizeSel = document.getElementById('cf-size');
            sizeSel.innerHTML = '';

            const item = caffeineDB[cat][menuIdx];
            item.sizes.forEach((size, idx) => {
                sizeSel.add(new Option(`${size.name} (${size.caf}mg)`, size.caf));
            });
        }

        function addCaffeineItem() {
            const cat = document.getElementById('cf-category').value;
            const menuIdx = document.getElementById('cf-menu').value;
            const item = caffeineDB[cat][menuIdx];
            const sizeCaf = parseFloat(document.getElementById('cf-size').value);
            const timeVal = document.getElementById('cf-time').value;

            if (!timeVal) return alert("ì„­ì·¨ ì‹œê°„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");

            currentIntake.push({
                name: item.name,
                caf: sizeCaf,
                time: timeVal,
                id: Date.now()
            });

            renderCaffeineList();
            calcCaffeine();
        }

        function removeCaffeineItem(id) {
            currentIntake = currentIntake.filter(x => x.id !== id);
            renderCaffeineList();
            calcCaffeine();
        }

        function renderCaffeineList() {
            const list = document.getElementById('cf-intake-list');
            list.innerHTML = '';

            if (currentIntake.length === 0) {
                document.getElementById('cf-result-area').style.display = 'none';
                return;
            }
            document.getElementById('cf-result-area').style.display = 'block';

            currentIntake.forEach(item => {
                const div = document.createElement('div');
                div.style.cssText = "display:flex; justify-content:space-between; align-items:center; margin-bottom:8px; background:var(--bg-body); padding:10px; border-radius:8px;";
                div.innerHTML = `
                    <div>
                        <span style="font-weight:600; color:var(--text-main);">${item.name}</span>
                        <span style="font-size:0.85rem; color:var(--text-muted); margin-left:8px;">${item.caf}mg / ${item.time}</span>
                    </div>
                    <button style="border:none; background:none; color:var(--text-muted); cursor:pointer;" onclick="removeCaffeineItem(${item.id})">x</button>
                `;
                list.appendChild(div);
            });
        }

        function calcCaffeine() {
            const weight = parseFloat(document.getElementById('cf-weight').value) || 60;
            const condition = document.getElementById('cf-condition').value;

            // 1. Calc Limit
            let limit = 400; // Adult default
            if (condition === 'pregnant') limit = 300;
            if (condition === 'youth') limit = weight * 2.5;

            // 2. Calc Half-life
            let halfLife = 5;
            if (condition === 'smoker') halfLife = 3;
            if (condition === 'pregnant') halfLife = 9;
            // Youth varies but use conservative 5 or weight factor? Text says adult 5. Let's start with 5 for youth too or slightly higher? 
            // We will stick to prompt's logic: Smoker 3h, Pregnant 8-10h. Default 5h.

            // 3. Total & Sleep Simulation
            let totalCaf = 0;
            let maxFinishTime = 0; // The time when caf drops below 50mg

            // We need a reference "current" time? Or just calculate absolute finish time?
            // User wants "When can I sleep?".
            // We calculate each drink's decay individually relative to proper time.

            // Find the latest intake time to start simple logic? 
            // Better: Simulation.
            // Check level at every hour from "Now" until level < 50mg.

            // First, sum total initial
            currentIntake.forEach(i => totalCaf += i.caf);
            document.getElementById('cf-total-amount').innerText = `${totalCaf}mg`;

            // Limit Badge
            const badge = document.getElementById('cf-limit-badge');
            if (totalCaf <= limit * 0.5) {
                badge.innerText = "ì•ˆì „ (ì—¬ìœ )"; badge.className = "cf-badge cf-badge-safe";
            } else if (totalCaf <= limit) {
                badge.innerText = "ì ì • (ì£¼ì˜)"; badge.className = "cf-badge cf-badge-warn";
            } else {
                badge.innerText = "ì´ˆê³¼ (ìœ„í—˜)"; badge.className = "cf-badge cf-badge-danger";
            }

            // Sleep Time Prediction
            // Logic: Total remaining amount at time T < 50mg.
            // Sum(Drink_i * (0.5)^(Elapsed_i / HalfLife)) < 50

            // We simulate from the earliest intake time until 48 hours later.
            // Find earliest time
            let sorted = [...currentIntake].sort((a, b) => a.time.localeCompare(b.time));
            if (sorted.length === 0) return;

            let baseH = parseInt(sorted[0].time.split(':')[0]);

            // Iterate hours from baseH onwards
            let safeTimeStr = "ê³„ì‚° ë¶ˆê°€";

            for (let h = 0; h < 48; h++) {
                let checkTime = baseH + h;
                let currentTotal = 0;

                // Calculate remaining for each drink at (baseH + h)
                sorted.forEach(d => {
                    const dh = parseInt(d.time.split(':')[0]) + parseInt(d.time.split(':')[1]) / 60;
                    const elapsed = checkTime - dh;
                    if (elapsed > 0) {
                        currentTotal += d.caf * Math.pow(0.5, elapsed / halfLife);
                    } else if (elapsed > -1) { // Same hour or just before
                        currentTotal += d.caf;
                    }
                });

                if (currentTotal < 50) {
                    // Found safe time
                    // Convert checkTime (which could be > 24) to HH:00
                    let finishH = Math.floor(checkTime) % 24;
                    let finishD = Math.floor(checkTime / 24); // 0 = today, 1 = tomorrow

                    let dayLabel = finishD === 0 ? "ì˜¤ëŠ˜" : (finishD === 1 ? "ë‚´ì¼" : "ëª¨ë ˆ");
                    safeTimeStr = `${dayLabel} ${String(finishH).padStart(2, '0')}:00`;
                    break;
                }
            }

            document.getElementById('cf-sleep-time').innerText = safeTimeStr;

            // Advice Text
            const adviceBox = document.getElementById('cf-advice-text');
            let advice = "";
            if (totalCaf > limit) {
                advice += `âš ï¸ <strong>ì¼ì¼ ê¶Œì¥ëŸ‰(${limit}mg)ì„ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤.</strong> ì‹¬ì¥ ë‘ê·¼ê±°ë¦¼, ë¶ˆë©´ì¦ ë°œìƒ ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤.<br>`;
            }
            if (safeTimeStr.includes("ë‚´ì¼") || safeTimeStr.includes("ëª¨ë ˆ")) {
                advice += `ğŸ’¤ ì¹´í˜ì¸ ë¶„í•´ì— ì˜¤ëœ ì‹œê°„ì´ ê±¸ë¦½ë‹ˆë‹¤. ì˜¤ëŠ˜ ë°¤ ê¹Šì€ ì ì„ ìê¸° ì–´ë ¤ìš¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>`;
            } else {
                advice += `âœ… ì·¨ì¹¨ ì „ê¹Œì§€ ì¹´í˜ì¸ì´ ì¶©ë¶„íˆ ë¶„í•´ë  ê²ƒìœ¼ë¡œ ì˜ˆìƒë©ë‹ˆë‹¤.<br>`;
            }

            if (condition === 'smoker') advice += `<span style='font-size:0.8rem; color:#94a3b8;'>(*í¡ì—°ìëŠ” ì¹´í˜ì¸ ë¶„í•´ ì†ë„ê°€ ë¹ ë¥´ì§€ë§Œ, ê±´ê°•ì„ ìœ„í•´ í¡ì—°ê³¼ ì¹´í˜ì¸ ëª¨ë‘ ì¤„ì´ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.)</span>`;
            if (condition === 'pregnant') advice += `<span style='font-size:0.8rem; color:#f472b6;'>(*ì„ì‚°ë¶€ëŠ” íƒœì•„ë¥¼ ìœ„í•´ 300mg ì´í•˜ ì„­ì·¨ë¥¼ ì—„ê²©íˆ ê¶Œì¥í•©ë‹ˆë‹¤.)</span>`;

            adviceBox.innerHTML = advice;
        }

        // Init Hook
        window.addEventListener('load', () => {
            initCaffeine();
        });


        function toggleTheme() {
            const body = document.body;
            const current = body.getAttribute('data-theme');
            const next = current === 'dark' ? 'light' : 'dark';
            body.setAttribute('data-theme', next);
            document.getElementById('sun-icon').style.display = next === 'light' ? 'block' : 'none';
            document.getElementById('moon-icon').style.display = next === 'dark' ? 'block' : 'none';
        }

        function showCalc(id, e) {
            if (e) e.preventDefault();
            document.querySelectorAll('.calculator-view').forEach(v => v.classList.remove('active'));
            const target = document.getElementById(id);
            if (target) target.classList.add('active');
            document.querySelectorAll('.menu-link').forEach(l => l.classList.remove('active'));
            const activeLink = document.querySelector(`[href="#${id}"]`);
            if (activeLink) activeLink.classList.add('active');
            if (window.innerWidth <= 768) {
                if (target) target.scrollIntoView({ behavior: 'smooth' });
            }
        }

        // --- Input Helper ---
        function setToday(id) {
            const now = new Date();
            const y = now.getFullYear();
            const m = String(now.getMonth() + 1).padStart(2, '0');
            const d = String(now.getDate()).padStart(2, '0');
            document.getElementById(id).value = `${y}-${m}-${d}`;
        }

        // --- D-day Logic ---
        function calcDday() {
            const startVal = document.getElementById('dday-start').value;
            const targetVal = document.getElementById('dday-target').value;
            if (!startVal || !targetVal) return alert("ë‚ ì§œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");

            const start = new Date(startVal);
            const target = new Date(targetVal);
            const diff = target - start;
            const days = Math.ceil(diff / (1000 * 60 * 60 * 24));

            const resBox = document.getElementById('dday-val');
            const labelBox = document.getElementById('dday-label');

            if (days === 0) {
                resBox.innerText = "D-Day";
                labelBox.innerText = "ì˜¤ëŠ˜ì…ë‹ˆë‹¤!";
            } else if (days > 0) {
                resBox.innerText = `D-${days}`;
                labelBox.innerText = `${days}ì¼ ë‚¨ì•˜ìŠµë‹ˆë‹¤.`;
            } else {
                resBox.innerText = `D+${Math.abs(days)}`;
                labelBox.innerText = `${Math.abs(days)}ì¼ ì§€ë‚¬ìŠµë‹ˆë‹¤.`;
            }
        }

        // --- Age Logic ---
        function calcAge() {
            const birthVal = document.getElementById('age-birth').value;
            const baseVal = document.getElementById('age-base').value;
            if (!birthVal || !baseVal) return alert("ë‚ ì§œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");

            const birth = new Date(birthVal);
            const base = new Date(baseVal);

            let age = base.getFullYear() - birth.getFullYear();
            const m = base.getMonth() - birth.getMonth();
            if (m < 0 || (m === 0 && base.getDate() < birth.getDate())) {
                age--;
            }

            // Zodiac
            const zodiacs = ['ì›ìˆ­ì´', 'ë‹­', 'ê°œ', 'ë¼ì§€', 'ì¥', 'ì†Œ', 'í˜¸ë‘ì´', 'í† ë¼', 'ìš©', 'ë±€', 'ë§', 'ì–‘'];
            const z = zodiacs[birth.getFullYear() % 12];

            document.getElementById('age-val').innerText = `ë§Œ ${age}ì„¸`;
            document.getElementById('age-label').innerText = `${birth.getFullYear()}ë…„ìƒ (${z}ë )`;
        }

        // Lunar/Solar Conversion (Fixed API)
        function convertLunar() {
            const dateStr = document.getElementById('lunar-date').value;
            const mode = document.getElementById('lunar-mode').value;
            const resultVal = document.getElementById('lunar-val');

            if (!dateStr) {
                resultVal.innerText = "ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”";
                return;
            }

            if (typeof Solar === 'undefined' || typeof Lunar === 'undefined') {
                resultVal.innerText = "ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œê°€ ì§€ì—°ë˜ê³  ìˆìŠµë‹ˆë‹¤. ìƒˆë¡œê³ ì¹¨ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.";
                return;
            }

            const parts = dateStr.split('-');
            const y = parseInt(parts[0]);
            const m = parseInt(parts[1]);
            const d = parseInt(parts[2]);

            try {
                if (mode === 's2l') {
                    const solar = Solar.fromYmd(y, m, d);
                    const lunar = solar.getLunar();

                    let extraInfo = '';
                    try {
                        extraInfo = `${lunar.getYearInGanZhi()}ë…„ (${lunar.getYearShengXiao()}ë )`;
                    } catch (e) {
                        // Fallback mechanism
                        extraInfo = '';
                    }

                    resultVal.style.fontSize = "1.8rem";
                    resultVal.innerHTML = `<div>${lunar.getYear()}ë…„ ${lunar.getMonth()}ì›” ${lunar.getDay()}ì¼</div><div style="font-size:1.1rem; color:var(--text-muted); margin-top:0.5rem;">${extraInfo}</div>`;
                } else {
                    const lunar = Lunar.fromYmd(y, m, d);
                    const solar = lunar.getSolar();
                    resultVal.style.fontSize = "1.8rem";
                    resultVal.innerText = `${solar.getYear()}ë…„ ${solar.getMonth()}ì›” ${solar.getDay()}ì¼`;
                }
            } catch (error) {
                console.error(error);
                resultVal.style.fontSize = "1.1rem";
                resultVal.innerText = "ì˜¤ë¥˜ ë°œìƒ: " + error.message;
            }
        }

        // Word Count
        const wordInput = document.getElementById('word-input');
        if (wordInput) {
            wordInput.addEventListener('input', () => {
                const text = wordInput.value;
                document.getElementById('count-with').innerText = text.length;
                document.getElementById('count-without').innerText = text.replace(/\s/g, '').length;
                document.getElementById('count-lines').innerText = text ? text.split('\n').length : 0;
            });
        }

        // Unit Converter
        const units = {
            length: { mm: 1, cm: 10, m: 1000, km: 1000000, in: 25.4, ft: 304.8, yd: 914.4 },
            weight: { mg: 1, g: 1000, kg: 1000000, t: 1000000000, oz: 28349.5, lb: 453592 },
            volume: { ml: 1, l: 1000, m3: 1000000, gal: 3785.41 },
            speed: { m_s: 1, km_h: 0.277778, mph: 0.44704, knot: 0.514444 },
            time: { sec: 1, min: 60, hr: 3600, day: 86400 },
            area: { m2: 1, km2: 1000000, ac: 4046.86, ha: 10000, ft2: 0.092903, pyeong: 3.305785 }
        };

        function updateUnits() {
            const type = document.getElementById('unit-type').value;
            const fromSelect = document.getElementById('unit-from-type');
            const toSelect = document.getElementById('unit-to-type');
            fromSelect.innerHTML = '';
            toSelect.innerHTML = '';

            if (type === 'temp') {
                ['Celsius', 'Fahrenheit', 'Kelvin'].forEach(u => {
                    fromSelect.add(new Option(u, u));
                    toSelect.add(new Option(u, u));
                });
            } else {
                Object.keys(units[type]).forEach(u => {
                    fromSelect.add(new Option(u, u));
                    toSelect.add(new Option(u, u));
                });
            }
            toSelect.selectedIndex = fromSelect.options.length > 1 ? 1 : 0;
            convertUnit();
        }

        function convertUnit() {
            const type = document.getElementById('unit-type').value;
            const fromVal = parseFloat(document.getElementById('unit-from-val').value) || 0;
            const fromUnit = document.getElementById('unit-from-type').value;
            const toUnit = document.getElementById('unit-to-type').value;
            let result = 0;

            if (type === 'temp') {
                let celsius = 0;
                if (fromUnit === 'Celsius') celsius = fromVal;
                else if (fromUnit === 'Fahrenheit') celsius = (fromVal - 32) * 5 / 9;
                else if (fromUnit === 'Kelvin') celsius = fromVal - 273.15;

                if (toUnit === 'Celsius') result = celsius;
                else if (toUnit === 'Fahrenheit') result = (celsius * 9 / 5) + 32;
                else if (toUnit === 'Kelvin') result = celsius + 273.15;
            } else {
                const baseVal = fromVal * units[type][fromUnit];
                result = baseVal / units[type][toUnit];
            }

            document.getElementById('unit-to-val').value = result.toLocaleString(undefined, { maximumFractionDigits: 5 });
            document.getElementById('unit-result').innerText = `${fromVal} ${fromUnit} = ${result.toLocaleString(undefined, { maximumFractionDigits: 4 })} ${toUnit}`;
        }

        // Initialize
        setToday('dday-start');
        setToday('age-base');
        updateUnits();
        // --- Vacation Calculator Logic ---
        let vacState = {
            total: 0,
            used: 0,
            planned: 0,
            monthlyPlans: Array(12).fill(0).map(() => ({ count: 0, reason: '', memo: '' })) // 0-11 for Month 1-12
        };

        function switchVacTab(tab) {
            document.querySelectorAll('.vac-tab').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.vac-content-area').forEach(c => c.classList.remove('active'));

            // Find active tab button by onclick attribute match or Index? 
            // Simple approach: Iterate buttons and check if they contain the call
            // But efficient way: Just map tab name to index
            const tabMap = { 'basic': 0, 'plan': 1, 'expire': 2 };
            const btns = document.querySelectorAll('.vac-tab');
            if (btns[tabMap[tab]]) btns[tabMap[tab]].classList.add('active');

            const content = document.getElementById(`vac-content-${tab}`);
            if (content) content.classList.add('active');

            if (tab === 'plan') renderPlanGrid();
            if (tab === 'expire') renderExpire();
        }

        // Bridge for old onclicks if any remain, though we updated HTML
        function switchTab(tab) { switchVacTab(tab); }

        function toggleVacMethod() {
            const method = document.getElementById('vac-method').value;
            const box = document.getElementById('vac-manual-box');
            if (box) box.style.display = method === 'manual' ? 'block' : 'none';
        }
        // Bridge
        function toggleMethod() { toggleVacMethod(); }

        function calcVacationBasic() {
            const startStr = document.getElementById('vac-start').value;
            const endStr = document.getElementById('vac-end').value;
            let used = parseFloat(document.getElementById('vac-used').value) || 0;
            const method = document.getElementById('vac-method').value;

            if (!startStr || !endStr) return alert("ì…ì‚¬ì¼ê³¼ ê¸°ì¤€ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");

            const start = new Date(startStr);
            const end = new Date(endStr);
            if (end < start) return alert("ê¸°ì¤€ì¼ì´ ì…ì‚¬ì¼ë³´ë‹¤ ë¹ ë¥¼ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");

            // Tenure Calculation
            let years = end.getFullYear() - start.getFullYear();
            let months = end.getMonth() - start.getMonth();
            let days = end.getDate() - start.getDate();
            if (days < 0) { months--; days += 30; }
            if (months < 0) { years--; months += 12; }

            document.getElementById('res-period').innerText = `${years}ë…„ ${months}ê°œì›” ${days}ì¼`;

            // Rate (Manual/Auto)
            let rate = 100;
            if (method === 'manual') {
                const tot = parseFloat(document.getElementById('att-total').value) || 1;
                const act = parseFloat(document.getElementById('att-actual').value) || 0;
                rate = (act / tot) * 100;
            }
            if (document.getElementById('res-rate')) document.getElementById('res-rate').innerText = `${rate.toFixed(1)}%`;
            if (document.getElementById('res-usage-rate')) {
                // To be updated later
            }

            // Annual Leave Calculation
            let totalVac = 0;
            let historyHtml = '';

            // Logic: less than 1 year vs more
            if (years < 1) {
                // Monthly accrual: 1 per month worked
                // Calculate total months difference
                const monthDiffTotal = ((end.getFullYear() - start.getFullYear()) * 12) + (end.getMonth() - start.getMonth());
                // If rate < 80% (manual check), 0?
                const safeMonths = (method === 'manual' && rate < 80) ? 0 : monthDiffTotal;
                totalVac = Math.min(11, safeMonths);

                for (let i = 1; i <= totalVac; i++) {
                    historyHtml += createHistoryItem(`${i}ê°œì›”ì°¨`, 1, i);
                }
            } else {
                // Annual Arrcual
                let base = 15;
                if (years >= 3) {
                    base += Math.floor((years - 1) / 2);
                }
                if (base > 25) base = 25;

                if (method === 'manual' && rate < 80) base = 0;

                totalVac = base;
                historyHtml += createHistoryItem(`${years}ë…„ì°¨`, base, base);
            }

            vacState.total = totalVac;
            vacState.used = used;

            // Update UI
            document.getElementById('res-total').innerText = `${totalVac}ê°œ`;
            document.getElementById('history-grid').innerHTML = historyHtml;

            // Show Results
            document.getElementById('basic-placeholder').style.display = 'none';
            document.getElementById('basic-result-area').style.display = 'block';

            updateResults();
            renderPlanGrid();
            renderExpire();
        }

        // Helper for history
        function createHistoryItem(label, count, acc) {
            return `
                <div class="history-item">
                    <div class="history-month">${label}</div>
                    <div class="history-val">+${count}</div>
                    <div class="history-acc">ëˆ„ì  ${acc}</div>
                </div>
            `;
        }

        function updateResults() {
            const remain = vacState.total - vacState.used - vacState.planned;

            // Update Basic View
            if (document.getElementById('res-remain')) document.getElementById('res-remain').innerText = `${remain}ê°œ`;
            const usageRate = vacState.total > 0 ? ((vacState.used / vacState.total) * 100).toFixed(1) : 0;
            if (document.getElementById('res-usage-rate')) document.getElementById('res-usage-rate').innerText = `${usageRate}%`;

            // Update Plan View Dashboard
            if (document.getElementById('plan-total')) document.getElementById('plan-total').innerText = vacState.total;
            if (document.getElementById('plan-used')) document.getElementById('plan-used').innerText = vacState.used;
            if (document.getElementById('plan-planned')) document.getElementById('plan-planned').innerText = vacState.planned;
            if (document.getElementById('plan-remain')) document.getElementById('plan-remain').innerText = remain;
        }

        function renderPlanGrid() {
            const grid = document.getElementById('plan-grid');
            grid.innerHTML = '';
            const months = ['1ì›”', '2ì›”', '3ì›”', '4ì›”', '5ì›”', '6ì›”', '7ì›”', '8ì›”', '9ì›”', '10ì›”', '11ì›”', '12ì›”'];

            months.forEach((m, idx) => {
                const data = vacState.monthlyPlans[idx];
                const card = document.createElement('div');
                card.className = 'plan-card';
                card.innerHTML = `
                    <div class="plan-card-head">
                        <span>${m}</span>
                         <div style="display:flex; align-items:center; gap:5px;">
                            <span style="font-size:0.8rem; color:#94a3b8;">ì‚¬ìš©</span>
                            <input type="number" class="plan-input-mini" 
                                min="0" max="20" step="0.5" value="${data.count > 0 ? data.count : ''}" 
                                placeholder="0" oninput="updatePlan(${idx}, this.value)">
                        </div>
                    </div>
                    <select class="vac-input-control" style="margin-bottom:8px; padding:8px; font-size:0.85rem;" 
                        onchange="updatePlanMeta(${idx}, 'reason', this.value)">
                        <option value="">ëª©ì  ì„ íƒ...</option>
                        <option value="íœ´ì‹" ${data.reason === 'íœ´ì‹' ? 'selected' : ''}>íœ´ì‹</option>
                        <option value="ì—¬í–‰" ${data.reason === 'ì—¬í–‰' ? 'selected' : ''}>ì—¬í–‰</option>
                        <option value="ë³‘ì›" ${data.reason === 'ë³‘ì›' ? 'selected' : ''}>ë³‘ì›/ê±´ê°•</option>
                        <option value="ê²½ì¡°ì‚¬" ${data.reason === 'ê²½ì¡°ì‚¬' ? 'selected' : ''}>ê²½ì¡°ì‚¬</option>
                        <option value="ê¸°íƒ€" ${data.reason === 'ê¸°íƒ€' ? 'selected' : ''}>ê¸°íƒ€</option>
                    </select>
                    <input type="text" class="vac-input-control" style="padding:8px; font-size:0.85rem;" 
                        placeholder="ë©”ëª¨ë¥¼ ì…ë ¥í•˜ì„¸ìš”" value="${data.memo}" onchange="updatePlanMeta(${idx}, 'memo', this.value)">
                `;
                grid.appendChild(card);
            });
        }

        function updatePlan(idx, val) {
            const num = parseFloat(val) || 0;
            vacState.monthlyPlans[idx].count = num;

            // Recalc total planned
            vacState.planned = vacState.monthlyPlans.reduce((acc, cur) => acc + (parseFloat(cur.count) || 0), 0);

            // Refresh results
            updateResults();
            renderExpire(); // also update expire analysis
        }

        function renderExpire() {
            const today = new Date();
            const monthsLeft = 12 - today.getMonth(); // roughly remaining months in year
            const remain = vacState.total - vacState.used - vacState.planned; // Actual remaining

            // Risk Calc
            const rec = monthsLeft > 0 ? (remain / monthsLeft).toFixed(1) : remain;

            if (document.getElementById('exp-remain')) document.getElementById('exp-remain').innerText = `${remain}ê°œ`;
            if (document.getElementById('exp-months')) document.getElementById('exp-months').innerText = monthsLeft;
            if (document.getElementById('exp-rec')) document.getElementById('exp-rec').innerText = rec;

            // Logic for Badge
            const badge = document.getElementById('exp-badge');
            if (rec > 2.5) {
                badge.innerText = "ìœ„í—˜ (ì´‰ë°•)";
                badge.className = "risk-badge danger";
            } else if (rec > 1.5) {
                badge.innerText = "ì£¼ì˜";
                badge.className = "risk-badge warning";
            } else {
                badge.innerText = "ì•ˆì „ (ì—¬ìœ )";
                badge.className = "risk-badge safe";
            }

            // Simulation
            const simBox = document.getElementById('exp-simulation');
            if (simBox) {
                simBox.innerHTML = '';
                for (let i = 0; i < monthsLeft; i++) {
                    const mLabel = (today.getMonth() + i + 1) + 'ì›”';
                    const bar = document.createElement('div');
                    bar.className = 'vac-sim-bar';
                    bar.innerHTML = `
                        <div style="font-size:0.75rem; color:#94a3b8; margin-bottom:4px;">${mLabel}</div>
                        <div style="font-weight:700; color:#cbd5e1;">-${rec}</div>
                    `;
                    simBox.appendChild(bar);
                }
            }
        }

        // --- History Management ---
        function toggleHistoryModal(show) {
            const modal = document.getElementById('history-modal');
            if (show) {
                renderSavedHistory();
                modal.style.display = 'flex';
            } else {
                modal.style.display = 'none';
            }
        }

        function saveVacationData() {
            if (!confirm("âš ï¸ [ë³´ì•ˆ ì•ˆë‚´]\n\nì €ì¥ë˜ëŠ” ëª¨ë“  ë°ì´í„°ëŠ” ì„œë²„ë¡œ ì „ì†¡ë˜ì§€ ì•Šê³ ,\ní˜„ì¬ ì‚¬ìš© ì¤‘ì¸ ê¸°ê¸°ì˜ ë¸Œë¼ìš°ì €(Local Storage)ì—ë§Œ ì €ì¥ë©ë‹ˆë‹¤.\n\nê³µìš© PCë¥¼ ì‚¬ìš© ì¤‘ì´ë¼ë©´ íƒ€ì¸ì´ ë°ì´í„°ë¥¼ ë³¼ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì£¼ì˜í•´ì£¼ì„¸ìš”.\n\nê³„ì†í•´ì„œ ì €ì¥í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                return;
            }

            const currentData = {
                id: Date.now(),
                date: new Date().toLocaleString(),
                inputs: {
                    start: document.getElementById('vac-start').value,
                    end: document.getElementById('vac-end').value,
                    used: document.getElementById('vac-used').value,
                    method: document.getElementById('vac-method').value,
                    attTotal: document.getElementById('att-total').value,
                    attActual: document.getElementById('att-actual').value
                },
                state: vacState
            };

            // Save recent state as default
            localStorage.setItem('vac_data', JSON.stringify(vacState));
            localStorage.setItem('vac_inputs', JSON.stringify(currentData.inputs));

            // Add to history
            let history = JSON.parse(localStorage.getItem('vac_history') || '[]');
            history.unshift(currentData);
            if (history.length > 10) history = history.slice(0, 10); // keep max 10
            localStorage.setItem('vac_history', JSON.stringify(history));

            alert("ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.");
            updateHistoryCount();
        }

        function updateHistoryCount() {
            const history = JSON.parse(localStorage.getItem('vac_history') || '[]');
            const btn = document.getElementById('btn-history');
            if (btn) btn.innerText = `ğŸ”„ ì €ì¥ëœ ê¸°ë¡ (${history.length})`;
        }

        function renderSavedHistory() {
            const list = document.getElementById('saved-list');
            const history = JSON.parse(localStorage.getItem('vac_history') || '[]');

            list.innerHTML = '';

            if (history.length === 0) {
                list.innerHTML = '<div style="text-align:center; padding:20px; color:var(--text-muted);">ì €ì¥ëœ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }

            history.forEach(item => {
                const row = document.createElement('div');
                row.className = 'history-row';
                row.style.cssText = `
                    display: flex; justify-content: space-between; align-items: center;
                    padding: 12px; border-bottom: 1px solid var(--border);
                `;

                const summary = `${item.inputs.start} ì…ì‚¬ì (ì”ì—¬ ${item.state.total - item.state.used - item.state.planned}ê°œ)`;

                row.innerHTML = `
                    <div>
                        <div style="font-weight:600; font-size:0.95rem;">${summary}</div>
                        <div style="font-size:0.8rem; color:var(--text-muted);">${item.date} ì €ì¥ë¨</div>
                    </div>
                    <div style="display:flex; gap:8px;">
                        <button class="btn-mini" style="background:var(--primary); color:white; border:none;" onclick="loadHistoryItem(${item.id})">ë¶ˆëŸ¬ì˜¤ê¸°</button>
                        <button class="btn-mini" style="background:var(--secondary); color:white; border:none;" onclick="deleteHistoryItem(${item.id})">ì‚­ì œ</button>
                    </div>
                `;
                list.appendChild(row);
            });
        }

        function loadHistoryItem(id) {
            const history = JSON.parse(localStorage.getItem('vac_history') || '[]');
            const item = history.find(x => x.id === id);
            if (!item) return;

            if (!confirm("ì„ íƒí•œ ê¸°ë¡ì„ ë¶ˆëŸ¬ì˜¤ì‹œê² ìŠµë‹ˆê¹Œ?\ní˜„ì¬ ì…ë ¥ëœ ë‚´ìš©ì€ ë®ì–´ì”Œì›Œì§‘ë‹ˆë‹¤.")) return;

            // Restore Inputs
            document.getElementById('vac-start').value = item.inputs.start;
            document.getElementById('vac-end').value = item.inputs.end;
            document.getElementById('vac-used').value = item.inputs.used;
            document.getElementById('vac-method').value = item.inputs.method || 'auto';
            document.getElementById('att-total').value = item.inputs.attTotal || '';
            document.getElementById('att-actual').value = item.inputs.attActual || '';

            toggleMethod();

            // Restore State
            vacState = item.state;

            // Re-render
            calcVacationBasic(); // recalculate basics
            // Ensure plan state is preserved/restored
            vacState.monthlyPlans = item.state.monthlyPlans;
            vacState.planned = item.state.planned;

            updateResults();
            renderPlanGrid();
            renderExpire();

            toggleHistoryModal(false);
            alert("ë¶ˆëŸ¬ì˜¤ê¸°ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");
        }

        function deleteHistoryItem(id) {
            if (!confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
            let history = JSON.parse(localStorage.getItem('vac_history') || '[]');
            history = history.filter(x => x.id !== id);
            localStorage.setItem('vac_history', JSON.stringify(history));
            renderSavedHistory();
            updateHistoryCount();
        }

        // --- Work Time Calculator Logic ---
        function calcWorkTime() {
            const startStr = document.getElementById('work-start').value;
            const endStr = document.getElementById('work-end').value;
            const breakMins = parseFloat(document.getElementById('work-break').value) || 0;
            const wage = parseFloat(document.getElementById('work-wage').value) || 9860;
            const isHoliday = document.getElementById('work-holiday').checked;

            if (!startStr || !endStr) return alert("ì¶œí‡´ê·¼ ì‹œê°„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");

            const [sh, sm] = startStr.split(':').map(Number);
            const [eh, em] = endStr.split(':').map(Number);

            let startMin = sh * 60 + sm;
            let endMin = eh * 60 + em;
            if (endMin < startMin) endMin += 24 * 60; // Next day

            const totalSpan = endMin - startMin;
            const workMin = Math.max(0, totalSpan - breakMins);

            // Basic / Overtime
            let basicMin = Math.min(workMin, 480);
            let overtimeMin = Math.max(0, workMin - 480);

            // Night Logic (22:00 ~ 06:00)
            let nightMin = 0;
            const nightRanges = [
                [0, 360],      // 00:00 - 06:00
                [1320, 1800],  // 22:00 - 30:00
                [2760, 3240]   // 46:00 ...
            ];

            // Intersection Helper
            function getOverlap(r1, r2) {
                const start = Math.max(r1[0], r2[0]);
                const end = Math.min(r1[1], r2[1]);
                return Math.max(0, end - start);
            }

            nightRanges.forEach(range => {
                nightMin += getOverlap([startMin, endMin], range);
            });
            nightMin = Math.min(nightMin, workMin);

            // Wage Calc
            const basicFactor = isHoliday ? 1.5 : 1.0;
            const overFactor = isHoliday ? 2.0 : 1.5;
            const nightFactor = 0.5;

            const basicPay = (basicMin / 60) * wage * basicFactor;
            const overPay = (overtimeMin / 60) * wage * overFactor;
            const nightPay = (nightMin / 60) * wage * nightFactor;
            const totalPay = basicPay + overPay + nightPay;

            // Render
            function m2t(m) {
                const h = Math.floor(m / 60);
                const mm = Math.floor(m % 60);
                return `${h}ì‹œê°„ ${mm}ë¶„`;
            }

            document.getElementById('wt-total').innerText = m2t(workMin);
            document.getElementById('wt-basic').innerText = m2t(basicMin);
            document.getElementById('wt-over').innerText = m2t(overtimeMin);
            document.getElementById('wt-night').innerText = m2t(nightMin);
            document.getElementById('wt-wage').innerText = new Intl.NumberFormat('ko-KR').format(Math.floor(totalPay)) + "ì›";
        }

        // Load on Init
        window.addEventListener('load', () => {
            // ìƒˆë¡œê³ ì¹¨ ì‹œ ë°ì´í„° ì´ˆê¸°í™” (ìë™ ë³µì› ê¸°ëŠ¥ ì œê±°)
            updateHistoryCount();
        });
        // --- Work Time Dashboard Logic (New) ---
        function switchWorkTab(tab) {
            document.querySelectorAll('.wt-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.wt-content').forEach(c => c.classList.remove('active'));

            const targetBtn = Array.from(document.querySelectorAll('.wt-tab')).find(b => b.getAttribute('onclick').includes(tab));
            if (targetBtn) targetBtn.classList.add('active');

            document.getElementById(`wt-view-${tab}`).classList.add('active');
        }

        function renderWeeklyRows() {
            const container = document.getElementById('wt-daily-list');
            if (!container) return; // Guard
            const startVal = document.getElementById('wt-start-date').value;
            if (!startVal) {
                const now = new Date();
                const day = now.getDay();
                const diff = now.getDate() - day + (day == 0 ? -6 : 1);
                const monday = new Date(now.setDate(diff));
                document.getElementById('wt-start-date').value = monday.toISOString().split('T')[0];
                return renderWeeklyRows();
            }

            const startDate = new Date(startVal);
            let html = '';

            for (let i = 0; i < 7; i++) {
                const cur = new Date(startDate);
                cur.setDate(startDate.getDate() + i);

                const yyyy = cur.getFullYear();
                const mm = String(cur.getMonth() + 1).padStart(2, '0');
                const dd = String(cur.getDate()).padStart(2, '0');
                const dateStr = `${yyyy}-${mm}-${dd}`;

                const dayIdx = cur.getDay();
                const dayName = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '][dayIdx];
                const isWeekend = (dayIdx === 0 || dayIdx === 6);

                html += `
                <div class="wt-day-card">
                    <div class="wt-day-header">
                        <div style="font-weight:600; display:flex; align-items:center; gap:8px;">
                            ${dayName}ìš”ì¼ <span style="font-size:0.85rem; color:var(--text-muted); font-weight:normal;">(${dateStr})</span>
                            ${isWeekend ? '<span class="wt-badge off">ì£¼ë§</span>' : '<span class="wt-badge work">í‰ì¼</span>'}
                        </div>
                        <label style="font-size:0.85rem; display:flex; align-items:center; gap:4px; cursor:pointer;">
                            <input type="checkbox" class="wt-check-holiday" data-idx="${i}" ${dayIdx === 0 ? 'checked' : ''}> 
                            <span style="color:#ef4444;">íœ´ì¼ê·¼ë¬´</span>
                        </label>
                    </div>
                    <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:12px;">
                        <div>
                            <label style="font-size:0.8rem; color:var(--text-muted);">ì¶œê·¼</label>
                            <input type="time" class="wt-in" data-idx="${i}" onwheel="event.preventDefault()" style="width:100%; padding:8px; border:1px solid var(--border); border-radius:8px; background:var(--card-bg); color:var(--text-main);">
                        </div>
                        <div>
                            <label style="font-size:0.8rem; color:var(--text-muted);">í‡´ê·¼</label>
                            <input type="time" class="wt-out" data-idx="${i}" onwheel="event.preventDefault()" style="width:100%; padding:8px; border:1px solid var(--border); border-radius:8px; background:var(--card-bg); color:var(--text-main);">
                        </div>
                        <div>
                            <label style="font-size:0.8rem; color:var(--text-muted);">íœ´ê²Œ(ë¶„)</label>
                            <input type="number" class="wt-break" data-idx="${i}" value="60" onwheel="event.preventDefault()" style="width:100%; padding:8px; border:1px solid var(--border); border-radius:8px; background:var(--card-bg); color:var(--text-main);">
                        </div>
                    </div>
                </div>
                `;
            }
            container.innerHTML = html;
        }

        function calcWeeklyAll() {
            const wage = parseFloat(document.getElementById('wt-wage-in').value) || 0;
            const rows = document.querySelectorAll('.wt-day-card');

            let totalWorkMins = 0;
            let totalHolidayMins = 0;
            let totalNightMins = 0;
            let dailyResults = [];

            // 1. Calculate Daily Stats
            rows.forEach((row, idx) => {
                const inVal = row.querySelector('.wt-in').value;
                const outVal = row.querySelector('.wt-out').value;
                const breakVal = parseFloat(row.querySelector('.wt-break').value) || 0;
                const isHol = row.querySelector('.wt-check-holiday').checked;

                if (!inVal || !outVal) {
                    dailyResults.push(null);
                    return;
                }

                const [sh, sm] = inVal.split(':').map(Number);
                const [eh, em] = outVal.split(':').map(Number);
                let startM = sh * 60 + sm;
                let endM = eh * 60 + em;
                if (endM < startM) endM += 1440;

                const span = endM - startM;
                const workM = Math.max(0, span - breakVal);

                let nightM = 0;
                [[0, 360], [1320, 1800], [2760, 3240]].forEach(r => {
                    const s = Math.max(startM, r[0]);
                    const e = Math.min(endM, r[1]);
                    nightM += Math.max(0, e - s);
                });
                nightM = Math.min(nightM, workM);

                // Daily Basic vs Overtime (Daily > 8h)
                let basic = 0;
                let over = 0;
                if (workM > 480) { basic = 480; over = workM - 480; }
                else { basic = workM; }

                dailyResults.push({
                    workM, basic, over, nightM, isHol,
                    dateStr: row.querySelector('div > span').innerText, // Date string
                    dayName: row.querySelector('div').innerText.substring(0, 1) // Mon, Tue...
                });
            });

            // 2. Weekly Aggregation & Cost Calculation
            let weekBasicAcc = 0;
            let weekOverAcc = 0;
            let totalPay = 0;

            let detailHtml = '';
            let allowanceHtml = '';

            let totalDays = 0;

            const formatter = new Intl.NumberFormat('ko-KR');

            dailyResults.forEach((d, i) => {
                if (!d) return;
                totalDays++;

                totalWorkMins += d.workM;
                totalNightMins += d.nightM;

                let dayPay = 0;
                let dayOverPay = 0;
                let dayNightPay = 0;
                let dayHolPay = 0;

                // Base Pay (1.0)
                dayPay += (d.workM / 60) * wage;

                // Night Allowance (+0.5)
                const nPay = (d.nightM / 60) * wage * 0.5;
                dayPay += nPay;
                if (d.nightM > 0) dayNightPay += nPay;

                if (d.isHol) {
                    // Holiday Allowance
                    // <8h: +0.5, >8h: +1.0
                    let hPay = 0;
                    if (d.workM <= 480) {
                        hPay = (d.workM / 60) * wage * 0.5;
                    } else {
                        hPay = (480 / 60) * wage * 0.5;
                        const excess = d.workM - 480;
                        hPay += (excess / 60) * wage * 1.0;
                    }
                    dayPay += hPay;
                    dayHolPay += hPay;
                    totalHolidayMins += d.workM;
                } else {
                    // Weekday Overtime (+0.5 for >8h)
                    const oPay = (d.over / 60) * wage * 0.5;
                    dayPay += oPay;
                    if (d.over > 0) dayOverPay += oPay;
                    weekOverAcc += d.over;

                    // Weekly Basic Trigger (>40h) -> +0.5
                    if (weekBasicAcc + d.basic > 2400) {
                        const available = Math.max(0, 2400 - weekBasicAcc);
                        const overflow = d.basic - available;

                        const wOverPay = (overflow / 60) * wage * 0.5;
                        dayPay += wOverPay;
                        dayOverPay += wOverPay; // Add to "Overtime" bucket for display
                        weekOverAcc += overflow;

                        weekBasicAcc = 2400;
                    } else {
                        weekBasicAcc += d.basic;
                    }
                }

                totalPay += dayPay;

                // Generate HTML for Daily Detail List (Result View)
                const typeBadge = d.isHol ? '<span class="wt-badge holiday" style="margin-left:6px;">íœ´ë¬´</span>' : '';
                detailHtml += `
                    <div style="display:flex; justify-content:space-between; align-items:center; padding:12px 16px; border-bottom:1px solid var(--border);">
                        <div style="display:flex; align-items:center;">
                            <span style="font-weight:600; width:30px; color:var(--text-main);">${d.dayName}</span>
                            <span style="font-size:0.85rem; color:var(--text-muted); margin-left:8px;">${d.dateStr.replace(/[()]/g, '')}</span>
                            ${typeBadge}
                        </div>
                        <div style="text-align:right;">
                            <span style="display:block; font-size:0.9rem; color:var(--text-main);">${(d.workM / 60).toFixed(1)}h ${d.workM % 60}m</span>
                            <span style="display:block; font-size:0.95rem; font-weight:700; color:#10b981;">${formatter.format(Math.floor(dayPay))}ì›</span>
                        </div>
                    </div>
                `;

                // Generate HTML for Allowance Detail List
                let allowanceParts = [];
                if (d.over > 0) allowanceParts.push(`ì—°ì¥: ${(d.over / 60).toFixed(1)}h (+${formatter.format(dayOverPay)}ì›)`);
                if (d.nightM > 0) allowanceParts.push(`ì•¼ê°„: ${(d.nightM / 60).toFixed(1)}h (+${formatter.format(dayNightPay)}ì›)`);
                if (d.isHol) allowanceParts.push(`íœ´ì¼: ${(d.workM / 60).toFixed(1)}h (+${formatter.format(dayHolPay)}ì›)`);

                if (allowanceParts.length > 0) {
                    allowanceHtml += `
                    <div style="padding:12px; border-bottom:1px solid var(--border);">
                        <div style="display:flex; justify-content:space-between; margin-bottom:4px;">
                            <span style="font-weight:600;">${d.dayName}ìš”ì¼ (${d.isHol ? 'íœ´ì¼' : 'í‰ì¼'})</span>
                            <strong style="color:var(--primary);">${formatter.format(Math.floor(dayPay))}ì›</strong>
                        </div>
                        <div style="font-size:0.85rem; color:var(--text-muted);">
                            ${allowanceParts.join(' / ')}
                        </div>
                    </div>`;
                }
            });

            // 3. Render Views
            // A. Weekly Result View (Bright Style)
            const resultBox = document.getElementById('wt-weekly-result-box');
            if (!resultBox) {
                // Create Result Box dynamically if not exists
                const container = document.getElementById('wt-view-weekly');
                const box = document.createElement('div');
                box.id = 'wt-weekly-result-box';
                box.style.marginTop = '24px';
                container.appendChild(box);
            }

            const remain52 = (52 * 60) - totalWorkMins;
            const isSafe = remain52 >= 0;

            document.getElementById('wt-weekly-result-box').innerHTML = `
                <h3 style="margin-bottom:12px; font-size:1rem; color:#10b981; display:flex; align-items:center; gap:6px;">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline><polyline points="17 6 23 6 23 12"></polyline></svg>
                    ì£¼ê°„ ê·¼ë¬´ ê²°ê³¼
                </h3>
                <div style="display:grid; grid-template-columns:repeat(4, 1fr); gap:10px; margin-bottom:20px;">
                    <div style="background:#1e3a8a; padding:16px; border-radius:8px; text-align:center; color:white;">
                        <div style="font-size:1.2rem; font-weight:700;">${(totalWorkMins / 60).toFixed(0)}ì‹œê°„</div>
                        <div style="font-size:0.75rem; opacity:0.8;">ì´ ê·¼ë¬´ì‹œê°„</div>
                    </div>
                    <div style="background:#451a03; padding:16px; border-radius:8px; text-align:center; color:white;">
                        <div style="font-size:1.2rem; font-weight:700; color:#fb923c;">${(weekOverAcc / 60).toFixed(0)}ì‹œê°„</div>
                        <div style="font-size:0.75rem; opacity:0.8;">ì—°ì¥ê·¼ë¬´</div>
                    </div>
                    <div style="background:#064e3b; padding:16px; border-radius:8px; text-align:center; color:white;">
                        <div style="font-size:1.2rem; font-weight:700; color:#4ade80;">${Math.max(0, remain52 / 60).toFixed(0)}ì‹œê°„</div>
                        <div style="font-size:0.75rem; opacity:0.8;">ì”ì—¬ ê°€ëŠ¥ì‹œê°„</div>
                    </div>
                     <div style="background:#312e81; padding:16px; border-radius:8px; text-align:center; color:white;">
                        <div style="font-size:1.2rem; font-weight:700; color:${isSafe ? '#c084fc' : '#f43f5e'};">${isSafe ? 'ì¤€ìˆ˜' : 'ì´ˆê³¼'}</div>
                        <div style="font-size:0.75rem; opacity:0.8;">52ì‹œê°„ í•œë„</div>
                    </div>
                </div>

                <div style="background:var(--bg-body); border-radius:12px; border:1px solid var(--border); overflow:hidden; box-shadow:0 1px 3px rgba(0,0,0,0.1);">
                    <div style="padding:12px 16px; background:rgba(0,0,0,0.02); border-bottom:1px solid var(--border); font-weight:600; color:var(--text-main); font-size:0.9rem;">
                        ğŸ“Š ì¼ë³„ ê·¼ë¬´ ìƒì„¸
                    </div>
                    <div style="background:var(--card-bg);">${detailHtml || '<div style="padding:20px; text-align:center; color:var(--text-muted);">ê·¼ë¬´ ê¸°ë¡ ì—†ìŒ</div>'}</div>
                    <div style="padding:16px; background:rgba(0,0,0,0.02); display:flex; justify-content:space-between; align-items:center; border-top:1px solid var(--border);">
                        <span style="font-weight:700; color:var(--text-main);">ì£¼ê°„ í•©ê³„</span>
                        <div>
                             <span style="color:#60a5fa; font-weight:700; margin-right:10px;">${(totalWorkMins / 60).toFixed(0)}ì‹œê°„</span>
                             <span style="color:#4ade80; font-weight:700; font-size:1.1rem;">${formatter.format(Math.floor(totalPay))}ì›</span>
                        </div>
                    </div>
                </div>

                <div style="display:flex; gap:10px; margin-top:16px;">
                    <button style="flex:1; padding:14px; background:#10b981; color:white; border:none; border-radius:8px; font-weight:700; cursor:pointer; display:flex; align-items:center; justify-content:center; gap:8px;" onclick="saveWeeklyResult()">
                        ğŸ’¾ ì£¼ê°„ ê³„ì‚° ê²°ê³¼ ì €ì¥
                    </button>
                    <button id="btn-wt-history" style="flex:1; padding:14px; background:var(--bg-body); color:var(--text-main); border:1px solid var(--border); border-radius:8px; font-weight:700; cursor:pointer; display:flex; align-items:center; justify-content:center; gap:8px;" onclick="toggleWorkHistoryModal(true)">
                        ğŸ”„ ì €ì¥ëœ ê¸°ë¡ (0)
                    </button>
                </div>
            `;

            // B. Allowance Tab
            const allowanceContainer = document.getElementById('wt-allowance-list');
            if (allowanceHtml) {
                allowanceContainer.innerHTML = allowanceHtml;
                document.getElementById('wt-allowance-placeholder').style.display = 'none';
                document.getElementById('wt-allowance-result').style.display = 'block';
            } else {
                allowanceContainer.innerHTML = '<div style="text-align:center; padding:20px; color:var(--text-muted);">ê°€ì‚° ìˆ˜ë‹¹ ë°œìƒ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                document.getElementById('wt-allowance-placeholder').style.display = 'none';
                document.getElementById('wt-allowance-result').style.display = 'block';
            }

            // C. Analysis Tab (Total + Monthly Projection)
            // Monthly Projection Logic: Avg 4.345 weeks per month
            const monthFactor = 4.345;
            const estMonthPay = totalPay * monthFactor;
            const estMonthHours = (totalWorkMins / 60) * monthFactor;
            const estMonthDays = totalDays * monthFactor;

            const analysisContainer = document.getElementById('wt-view-analysis');
            analysisContainer.innerHTML = `
                <h3 style="margin-bottom:12px; font-size:1rem; color:#10b981; display:flex; align-items:center; gap:6px;">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline><polyline points="17 6 23 6 23 12"></polyline></svg>
                    ê·¼ë¬´ íŒ¨í„´ ë¶„ì„
                </h3>
                 <div style="display:grid; grid-template-columns:repeat(4, 1fr); gap:10px; margin-bottom:20px;">
                    <div style="background:#1e3a8a; padding:16px; border-radius:8px; text-align:center; color:white;">
                        <div style="font-size:1.2rem; font-weight:700;">${(totalWorkMins / 60).toFixed(0)}ì‹œê°„</div>
                        <div style="font-size:0.75rem; opacity:0.8;">ì£¼ ì´ ê·¼ë¬´ì‹œê°„</div>
                    </div>
                    <div style="background:#451a03; padding:16px; border-radius:8px; text-align:center; color:white;">
                        <div style="font-size:1.2rem; font-weight:700; color:#fb923c;">${(weekOverAcc / 60).toFixed(0)}ì‹œê°„</div>
                        <div style="font-size:0.75rem; opacity:0.8;">ì£¼ ì—°ì¥ê·¼ë¬´</div>
                    </div>
                    <div style="background:#064e3b; padding:16px; border-radius:8px; text-align:center; color:white;">
                        <div style="font-size:1.2rem; font-weight:700; color:#4ade80;">${Math.max(0, remain52 / 60).toFixed(0)}ì‹œê°„</div>
                        <div style="font-size:0.75rem; opacity:0.8;">ì”ì—¬ ê°€ëŠ¥ì‹œê°„</div>
                    </div>
                     <div style="background:#312e81; padding:16px; border-radius:8px; text-align:center; color:white;">
                        <div style="font-size:1.2rem; font-weight:700; color:${isSafe ? '#c084fc' : '#f43f5e'};">${isSafe ? 'ì¤€ìˆ˜' : 'ì´ˆê³¼'}</div>
                        <div style="font-size:0.75rem; opacity:0.8;">52ì‹œê°„ í•œë„</div>
                    </div>
                </div>

                <div style="background:var(--bg-body); border-radius:12px; border:1px solid var(--border); padding:20px; margin-top:24px; box-shadow:0 1px 3px rgba(0,0,0,0.1);">
                    <h4 style="margin-bottom:16px; color:var(--text-main); display:flex; align-items:center; gap:8px;">
                        ğŸ“… ì›”ê°„ ê·¼ë¬´ í†µê³„ (ì˜ˆìƒ)
                        <span style="font-size:0.75rem; font-weight:normal; color:var(--text-muted); background:rgba(0,0,0,0.05); padding:2px 6px; border-radius:4px;">í˜„ì¬ ì£¼ê°„ íŒ¨í„´ ê¸°ì¤€</span>
                    </h4>
                    <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:16px;">
                        <div style="text-align:center; padding:16px; background:var(--card-bg); border-radius:8px; border:1px solid var(--border);">
                            <div style="font-size:1.5rem; font-weight:700; color:var(--text-main);">${estMonthDays.toFixed(0)}ì¼</div>
                            <div style="font-size:0.8rem; color:var(--text-muted); margin-top:4px;">ì´ ê·¼ë¬´ì¼ìˆ˜</div>
                        </div>
                        <div style="text-align:center; padding:16px; background:var(--card-bg); border-radius:8px; border:1px solid var(--border);">
                            <div style="font-size:1.5rem; font-weight:700; color:var(--text-main);">${estMonthHours.toFixed(0)}ì‹œê°„</div>
                            <div style="font-size:0.8rem; color:var(--text-muted); margin-top:4px;">ì´ ê·¼ë¬´ì‹œê°„</div>
                        </div>
                         <div style="text-align:center; padding:16px; background:var(--card-bg); border-radius:8px; border:1px solid var(--border);">
                            <div style="font-size:1.5rem; font-weight:700; color:#10b981;">${formatter.format(Math.floor(estMonthPay))}ì›</div>
                            <div style="font-size:0.8rem; color:var(--text-muted); margin-top:4px;">ì˜ˆìƒ ì›”ê¸‰</div>
                        </div>
                    </div>
                </div>

                <div style="margin-top:20px; border:1px solid #dbeafe; background:#eff6ff; border-radius:8px; padding:16px; color:#1e40af; font-size:0.85rem; line-height:1.6;">
                    <strong>â„¹ï¸ 2026ë…„ ê·¼ë¡œê¸°ì¤€ë²• ê¸°ì¤€</strong><br>
                    <div style="display:grid; grid-template-columns:1fr 1fr; gap:16px; margin-top:8px;">
                        <div>
                            â€¢ ë²•ì • ê·¼ë¡œì‹œê°„: ì£¼ 40ì‹œê°„, 1ì¼ 8ì‹œê°„<br>
                            â€¢ ì—°ì¥ê·¼ë¬´ ìˆ˜ë‹¹: í†µìƒì„ê¸ˆì˜ 50% ê°€ì‚°<br>
                            â€¢ íœ´ì¼ê·¼ë¬´ ìˆ˜ë‹¹: 8ì‹œê°„ ì´í•˜ 50%, ì´ˆê³¼ ì‹œ 100% ê°€ì‚°
                        </div>
                        <div>
                            â€¢ ì—°ì¥ê·¼ë¬´ í•œë„: ì£¼ 12ì‹œê°„ (ì´ 52ì‹œê°„)<br>
                            â€¢ ì•¼ê°„ê·¼ë¬´ ìˆ˜ë‹¹: 22ì‹œ~06ì‹œ, 50% ê°€ì‚°<br>
                            â€¢ íœ´ê²Œì‹œê°„: 4ì‹œê°„ ê·¼ë¬´ ì‹œ 30ë¶„, 8ì‹œê°„ ê·¼ë¬´ ì‹œ 1ì‹œê°„
                        </div>
                    </div>
                </div>
            `;
        }

        // --- Work Time History Management (Modal) ---
        function toggleWorkHistoryModal(show) {
            const modal = document.getElementById('wt-history-modal'); // Need to create HTML for this
            if (show) {
                renderSavedWorkHistory();
                modal.style.display = 'flex';
            } else {
                modal.style.display = 'none';
            }
        }

        function saveWeeklyResult() {
            if (!confirm("í˜„ì¬ ê³„ì‚°ëœ ì£¼ê°„ ê·¼ë¬´ ê²°ê³¼ë¥¼ ì €ì¥í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;

            const totalTime = document.getElementById('an-total-time')?.innerText || '0h';
            const pay = document.getElementById('an-wage')?.innerText || '0ì›';
            const startDate = document.getElementById('wt-start-date').value;

            // Capture Inputs State (for restoration)
            const inputs = [];
            document.querySelectorAll('.wt-day-card').forEach(row => {
                inputs.push({
                    in: row.querySelector('.wt-in').value,
                    out: row.querySelector('.wt-out').value,
                    break: row.querySelector('.wt-break').value,
                    isHol: row.querySelector('.wt-check-holiday').checked
                });
            });

            const data = {
                id: Date.now(),
                date: new Date().toLocaleString(),
                startDate: startDate,
                wage: document.getElementById('wt-wage-in').value,
                totalTime: totalTime,
                pay: pay,
                inputs: inputs
            };

            let history = JSON.parse(localStorage.getItem('wt_history') || '[]');
            history.unshift(data);
            if (history.length > 20) history = history.slice(0, 20);

            localStorage.setItem('wt_history', JSON.stringify(history));
            updateWorkHistoryCount();
            alert("ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.");
        }

        function updateWorkHistoryCount() {
            const history = JSON.parse(localStorage.getItem('wt_history') || '[]');
            const count = history.length;

            // Footer Button
            const btnMain = document.getElementById('btn-wt-history');
            if (btnMain) btnMain.innerText = `ğŸ”„ ì €ì¥ëœ ê¸°ë¡ (${count})`;

            // Header/Input Button (Mini)
            const btnMini = document.getElementById('btn-wt-history-mini');
            if (btnMini) btnMini.innerHTML = `ğŸ“‚ (${count})`;
        }

        function renderSavedWorkHistory() {
            const list = document.getElementById('wt-saved-list-modal'); // Inside Modal
            const history = JSON.parse(localStorage.getItem('wt_history') || '[]');

            list.innerHTML = '';

            if (history.length === 0) {
                list.innerHTML = '<div style="text-align:center; padding:20px; color:var(--text-muted);">ì €ì¥ëœ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }

            history.forEach(item => {
                const row = document.createElement('div');
                row.className = 'history-row';
                row.style.cssText = `
                    display: flex; justify-content: space-between; align-items: center;
                    padding: 12px; border-bottom: 1px solid var(--border);
                `;

                row.innerHTML = `
                    <div>
                        <div style="font-weight:600; font-size:0.95rem;">${item.startDate} ì£¼ê°„ (${item.totalTime})</div>
                        <div style="font-size:0.8rem; color:var(--text-muted);">${item.date} ì €ì¥ | ${item.pay}</div>
                    </div>
                    <div style="display:flex; gap:8px;">
                        <button class="btn-mini" style="background:var(--primary); color:white; border:none; padding:6px 10px; border-radius:6px; cursor:pointer;" onclick="loadWorkHistoryItem(${item.id})">ë¶ˆëŸ¬ì˜¤ê¸°</button>
                        <button class="btn-mini" style="background:var(--secondary); color:white; border:none; padding:6px 10px; border-radius:6px; cursor:pointer;" onclick="deleteWorkHistoryItem(${item.id})">ì‚­ì œ</button>
                    </div>
                `;
                list.appendChild(row);
            });
        }

        function loadWorkHistoryItem(id) {
            const history = JSON.parse(localStorage.getItem('wt_history') || '[]');
            const item = history.find(x => x.id === id);
            if (!item) return;

            if (!confirm("ì„ íƒí•œ ê¸°ë¡ì„ ë¶ˆëŸ¬ì˜¤ì‹œê² ìŠµë‹ˆê¹Œ?\ní˜„ì¬ ì…ë ¥ëœ ë‚´ìš©ì€ ë®ì–´ì”Œì›Œì§‘ë‹ˆë‹¤.")) return;

            // Restore
            document.getElementById('wt-start-date').value = item.startDate;
            document.getElementById('wt-wage-in').value = item.wage || 10320;

            renderWeeklyRows(); // Re-build DOM first

            // Restore Row Inputs
            const rows = document.querySelectorAll('.wt-day-card');
            item.inputs.forEach((inp, idx) => {
                if (rows[idx]) {
                    rows[idx].querySelector('.wt-in').value = inp.in;
                    rows[idx].querySelector('.wt-out').value = inp.out;
                    rows[idx].querySelector('.wt-break').value = inp.break;
                    rows[idx].querySelector('.wt-check-holiday').checked = inp.isHol;
                }
            });

            calcWeeklyAll(); // Re-calculate
            toggleWorkHistoryModal(false);
            alert("ë¶ˆëŸ¬ì˜¤ê¸°ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");
        }

        function deleteWorkHistoryItem(id) {
            if (!confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
            let history = JSON.parse(localStorage.getItem('wt_history') || '[]');
            history = history.filter(x => x.id !== id);
            localStorage.setItem('wt_history', JSON.stringify(history));
            renderSavedWorkHistory();
            updateWorkHistoryCount();
        }

        function resetWeekly() {
            renderWeeklyRows();
            document.getElementById('wt-allowance-result').style.display = 'none';
            document.getElementById('wt-allowance-placeholder').style.display = 'block';
            document.getElementById('wt-analysis-result').style.display = 'none';
            document.getElementById('wt-analysis-placeholder').style.display = 'block';
        }

        // Init Work Time 
        window.addEventListener('load', () => {
            const wtStart = document.getElementById('wt-start-date');
            if (wtStart && !wtStart.value) renderWeeklyRows();
            updateWorkHistoryCount(); // Init count btn
        });
    </script>
    <!-- Work Time History Modal -->
    <div id="wt-history-modal" class="modal-overlay"
        style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:9999; align-items:center; justify-content:center;"
        onclick="if(event.target === this) toggleWorkHistoryModal(false)">
        <div class="modal-content"
            style="background:var(--card-bg); width:90%; max-width:500px; border-radius:16px; border:1px solid var(--border); box-shadow:0 10px 25px rgba(0,0,0,0.2); overflow:hidden; animation:modalPop 0.2s ease-out;">
            <div class="modal-header"
                style="background:var(--bg-body); padding:16px 20px; border-bottom:1px solid var(--border); display:flex; justify-content:space-between; align-items:center;">
                <h3 style="margin:0; font-size:1.1rem; color:var(--text-main);">ğŸ’¾ ì €ì¥ëœ ì£¼ê°„ ë¦¬í¬íŠ¸</h3>
                <button class="modal-close"
                    style="background:none; border:none; color:var(--text-muted); font-size:1.5rem; cursor:pointer;"
                    onclick="toggleWorkHistoryModal(false)">Ã—</button>
            </div>
            <div id="wt-saved-list-modal" class="modal-body" style="padding:20px; max-height:60vh; overflow-y:auto;">
                <!-- JS Generated -->
            </div>
        </div>
    </div>
</body>

</html>